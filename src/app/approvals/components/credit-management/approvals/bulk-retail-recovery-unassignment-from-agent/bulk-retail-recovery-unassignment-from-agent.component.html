<div class="ui-g">
  <div class="ui-g-12 no-padding">
    <div class="card no-padding">
      <div class="panel panel-default">
        <div class="panel-heading">
          <div class="row">
            <div class="col-md-12">
              <h2 class="panel-title pull-left">
                Bulk Recovery Unassignment Awaiting Approval
              </h2>
            </div>
          </div>
        </div>
        <div class="panel-body">
          <p-dataTable
            [value]="loanOperationApprovalData"
            [paginator]="true"
            [rows]="10"
            [rowsPerPageOptions]="[10, 20, 30]"
            [responsive]="true"
            [(selection)]="loanSelection"
          >
            <p-column
              [style]="{ width: '50px' }"
              selectionMode="multiple"
              suppressRowClickSelection="false"
            ></p-column>
            <p-column
              field="requestDate"
              header="Date Created"
              sortable="true"
              [filter]="true"
              filterMatchMode="contains"
            >
              <ng-template let-d="rowData" let-i="rowIndex" pTemplate="body">
                {{ d.requestDate | date: "medium" }}
              </ng-template>
            </p-column>
            <p-column
              field="accreditedConsultantName"
              header="Consultant Name"
              sortable="true"
              [filter]="true"
              filterMatchMode="contains"
            ></p-column>
            <p-column
              field="accreditedConsultantCompany"
              header="Consultant Company"
              sortable="true"
              [filter]="true"
              filterMatchMode="contains"
            ></p-column>
            <p-column
              field="referenceId"
              header="Reference Id"
              sortable="true"
              [filter]="true"
              filterMatchMode="contains"
            ></p-column>
            <p-column
              [style]="{ width: '250px', 'text-align': 'center' }"
              *ngIf="loanSelection.length == 0"
            >
              <ng-template pTemplate="header"> Action </ng-template>
              <ng-template let-row="rowData" let-i="rowIndex" pTemplate="body">
                <button
                  type="button"
                  (click)="viewLoanDetails(row, $event)"
                  [disabled]="loanSelection.length > 0"
                >
                  View Loans
                </button>
                <span style="padding: 3px">|</span>
                <button
                  type="button"
                  (click)="approval(row, $event)"
                  [disabled]="loanSelection.length > 0"
                >
                  Approve
                </button>
              </ng-template>
            </p-column>
          </p-dataTable>
        </div>

        <div class="panel-footer" *ngIf="loanSelection.length > 0">
          <div class="row">
            <div class="col-md-12">
              <button
                type="button"
                (click)="bulkApproval()"
                [disabled]="loanSelection.length < 1"
                class="btn btn-success pull-right"
              >
                <span style="padding-right: 4px">{{ label }}</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<p-dialog
  [responsive]="true"
  [(visible)]="displayRestructuringApprovalModal"
  widgetVar="ajaxDialog"
  [contentStyle]="{ overflow: 'scroll', 'max-height': '600px' }"
  modal="modal"
  showEffect="fade"
  width="1200"
>
  <div class="panel-body">
    <div class="form-horizontal">
      <p-tabView>
        <p-tabPanel header="Bulk Recovery Loans">
          <p-dataTable
            [paginator]="true"
            [rows]="10"
            [value]="loanRecoveryApprovalData"
            [responsive]="true"
            [(selection)]="schemeSelection"
            dataKey="loanReferenceNumber"
            selectionMode="single"
          >
            <p-column
              field="loanReferenceNumber"
              header="Ref. Number"
              sortable="true"
              [filter]="true"
              filterMatchMode="contains"
            ></p-column>
            <p-column
              field="customerName"
              header="Customer Name"
              sortable="true"
              [filter]="true"
              filterMatchMode="contains"
            ></p-column>
            <p-column
              field="casaAccount"
              header="Customer Account"
              sortable="true"
              [filter]="true"
              filterMatchMode="contains"
            ></p-column>
            <p-column
              field="relationshipManagerName"
              header="Relationship Manager"
              sortable="true"
              [filter]="true"
              filterMatchMode="contains"
            ></p-column>
            <p-column
              field="effectiveDate"
              header="Facility Effective Date"
              sortable="false"
              [filter]="false"
              filterMatchMode="contains"
            >
              <ng-template let-col let-ln="rowData" pTemplate="body">
                {{ ln[col.field] | date: "medium" }}
              </ng-template>
            </p-column>
            <p-column
              field="maturityDate"
              header="Facity Maturity Date"
              sortable="false"
              [filter]="false"
              filterMatchMode="contains"
            >
              <ng-template let-col let-ln="rowData" pTemplate="body">
                {{ ln[col.field] | date: "medium" }}
              </ng-template>
            </p-column>
            <p-column
              field="expCompletionDate"
              header="Expected Completion Date"
              sortable="false"
              [filter]="false"
              filterMatchMode="contains"
            >
              <ng-template let-col let-ln="rowData" pTemplate="body">
                {{ ln[col.field] | date: "medium" }}
              </ng-template>
            </p-column>
          </p-dataTable>
        </p-tabPanel>
      </p-tabView>
      <div class="panel-footer">
        <div class="row">
          <div class="col-md-12">
            <div class="btn-group pull-right">
              <button
                (click)="hideModal()"
                type="button"
                class="btn btn-danger"
                style="margin-right: 5px"
              >
                Close
              </button>
              <!-- <button (click)="print()" type="button" class="btn btn-success" style="margin-right:5px">View</button> -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</p-dialog>

<p-dialog
  [responsive]="true"
  [(visible)]="displayBulkRecoveryApprovalModal"
  widgetVar="ajaxDialog"
  [contentStyle]="{ overflow: 'scroll', 'max-height': '600px' }"
  modal="modal"
  showEffect="fade"
  width="900"
>
  <div class="panel-body">
    <div class="form-horizontal">
      <p-tabView>
        <p-tabPanel header="Bulk Recovery Approval">
          <table class="table table-customer-information">
            <tbody>
              <tr>
                <td>
                  <strong>Comment</strong>
                </td>
                <td>
                  <textarea
                    [ngClass]="
                      !loanSelectedData.comment
                        ? 'required-input'
                        : 'valid-input'
                    "
                    class="form-control"
                    [(ngModel)]="loanSelectedData.comment"
                    name="comment"
                    cols="15"
                    rows="3"
                  ></textarea>
                </td>
                <td>
                  <strong>Status</strong>
                </td>
                <td>
                  <select
                    name="approvalStatusId"
                    id="approvalStatusId"
                    class="form-control"
                    [(ngModel)]="loanSelectedData.approvalStatusId"
                    [ngClass]="
                      !loanSelectedData.approvalStatusId
                        ? 'required-input'
                        : 'valid-input'
                    "
                  >
                    <option value="">--- Select Approval Status ---</option>
                    <option value="2">Approved</option>
                    <option value="3">Disapproved</option>
                    <!-- <option value="5">Referred</option> -->

                    <!-- <option *ngFor="let item of approvalStatusData" [value]="item.approvalStatusId">{{item.approvalStatusName}}</option> -->
                  </select>
                </td>
              </tr>
            </tbody>
          </table>
        </p-tabPanel>
      </p-tabView>
      <div class="panel-footer">
        <div class="row">
          <div class="col-md-12">
            <div class="btn-group pull-right">
              <button
                (click)="displayBulkRecoveryApprovalModal = false"
                type="button"
                class="btn btn-danger"
                style="margin-right: 5px"
              >
                Close
              </button>
              <button
                [disabled]="
                  !loanSelectedData.comment ||
                  !loanSelectedData.approvalStatusId
                "
                type="button"
                (click)="promptToGoForApproval(loanSelectedData)"
                style="margin-right: 5px"
                class="btn btn-success"
              >
                Submit For Approval
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</p-dialog>

<p-dialog
  [responsive]="true"
  [(visible)]="displayBulkApprovalModal"
  widgetVar="ajaxDialog"
  [contentStyle]="{ overflow: 'scroll', 'max-height': '600px' }"
  modal="modal"
  showEffect="fade"
  width="900"
>
  <form novalidate [formGroup]="bulkApprovalForm" autocomplete="off">
    <div class="panel-body">
      <div class="form-horizontal">
        <p-tabView>
          <p-tabPanel header="Bulk Recovery Approval">
            <table class="table table-customer-information">
              <tbody>
                <tr>
                  <td>
                    <strong>Comment</strong>
                  </td>
                  <td>
                    <textarea
                      [ngClass]="
                        !bulkApprovalForm.controls['comment'].valid
                          ? 'required-input'
                          : 'valid-input'
                      "
                      class="form-control"
                      name="comment"
                      cols="15"
                      formControlName="comment"
                      rows="3"
                    ></textarea>
                  </td>
                  <td>
                    <strong>Status</strong>
                  </td>
                  <td>
                    <select
                      name="approvalStatusId"
                      id="approvalStatusId"
                      class="form-control"
                      formControlName="approvalStatusId"
                      [ngClass]="
                        !bulkApprovalForm.controls['approvalStatusId'].valid
                          ? 'required-input'
                          : 'valid-input'
                      "
                    >
                      <option value="">--- Select Approval Status ---</option>
                      <option value="2">Approved</option>
                      <option value="3">Disapproved</option>
                    </select>
                  </td>
                </tr>
              </tbody>
            </table>
          </p-tabPanel>
        </p-tabView>
        <div class="panel-footer">
          <div class="row">
            <div class="col-md-12">
              <div class="btn-group pull-right">
                <button
                  (click)="displayBulkApprovalModal = false"
                  type="button"
                  class="btn btn-danger"
                  style="margin-right: 5px"
                >
                  Close
                </button>
                <button
                  [disabled]="bulkApprovalForm.invalid"
                  type="button"
                  (click)="promptToGoForBulkApproval(bulkApprovalForm)"
                  style="margin-right: 5px"
                  class="btn btn-success"
                >
                  Submit For Approval
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </form>
</p-dialog>

<app-fintrakbanking-dialog
  [title]="title"
  [show]="displayConfirmDialog"
  [width]="width"
  [message]="message"
  (approveEvent)="goForApproval(loanSelectedData)"
  (closeEvent)="cancelApproval()"
></app-fintrakbanking-dialog>

<p-dialog
  [responsive]="true"
  [(visible)]="displayCommentForm"
  id="comment-modal"
  modal="modal"
  showEffect="fade"
  width="1200"
>
  <div style="margin-bottom: 0" class="panel panel-default">
    <div class="panel-heading">
      <h2 class="panel-title">
        {{ commentTitle }}
        <!-- CHANGED: {{ recommendedItems.length }} -->
      </h2>
    </div>

    <div class="row">
      <div class="col-md-12">
        <div class="panel-body">
          <div *ngIf="warningMessage != ''" class="alert alert-danger">
            <strong>Warning!</strong> {{ warningMessage }}
          </div>

          <div
            style="
              display: inline-block;
              max-width: 100%;
              margin-bottom: 5px;
              font-weight: 700;
            "
          >
            Loans -
            <small>Select facility to review</small>
          </div>

          <p-dataTable
            [value]="proposedItems"
            [paginator]="true"
            [rows]="5"
            selectionMode="single"
            (onRowSelect)="onLineRowSelect($event.data)"
          >
            <p-column field="obligorName" header="Customer Name"></p-column>
            <p-column
              field="approvedProductName"
              header="Product Name"
            ></p-column>
            <p-column field="operationName" header="Operation"></p-column>
            <p-column field="reviewDetails" header="Review Details"></p-column>

            <p-column
              *ngIf="canSupport()"
              field="statusId"
              header="Status"
              [style]="{
                color: '#555',
                'text-align': 'center',
                width: '150px'
              }"
            >
              <ng-template let-d="rowData" let-i="rowIndex" pTemplate="body">
                <select
                  (change)="
                    onLineItemChange(
                      5,
                      $event.target.value,
                      d.loanApplicationDetailId
                    )
                  "
                >
                  <option *ngIf="d.statusId != 2 && d.statusId != 3" value="">
                    -- Select Status --
                  </option>
                  <option *ngIf="d.statusId != 3" value="3">
                    <small>Not Supported</small>
                  </option>
                  <option *ngIf="d.statusId != 2" value="2">
                    <small>Supported</small>
                  </option>
                  <option *ngIf="d.statusId == 3" value="3" selected="selected">
                    <small>Not Supported</small>
                  </option>
                  <option *ngIf="d.statusId == 2" value="2" selected="selected">
                    <small>Supported</small>
                  </option>
                </select>
              </ng-template>
            </p-column>

            <p-column
              field="statusId"
              header=""
              [style]="{ 'text-align': 'right', width: '30px' }"
            >
              <ng-template let-d="rowData" let-i="rowIndex" pTemplate="body">
                <span *ngIf="d.statusId == 2">
                  <i class="glyphicon glyphicon-ok"></i>
                </span>
                <span *ngIf="d.statusId == 3">
                  <i class="glyphicon glyphicon-remove"></i>
                </span>
              </ng-template>
            </p-column>

            <p-column
              field="loanApplicationDetailId"
              header=""
              [style]="{ 'text-align': 'right', width: '25px' }"
            >
              <ng-template let-d="rowData" let-i="rowIndex" pTemplate="body">
                <span
                  *ngIf="
                    touchedLineItems.indexOf(d.loanApplicationDetailId) > -1
                  "
                  >*</span
                >
              </ng-template>
            </p-column>
          </p-dataTable>
        </div>
      </div>
    </div>

    <form novalidate [formGroup]="commentForm" autocomplete="off">
      <div
        class="col-md-5"
        style="background-color: #f5f5f5; border-left: solid 1px #ccc"
      >
        <div class="panel-body">
          <div class="form-horizontal">
            <div *ngIf="forwardAction == 5" class="form-group">
              <label for="staffName" class="col-md-12"
                >Target Level / Staff</label
              >
              <div class="col-md-12">
                <select
                  (change)="onTargetStaffLevelChange($event.target.value)"
                  type="text"
                  name="trailId"
                  formControlName="trailId"
                  id="trailId"
                  class="form-control"
                  [ngClass]="
                    !commentForm.controls['trailId'].valid
                      ? 'required-input'
                      : 'valid-input'
                  "
                >
                  <option value="">-- Select Staff / Level --</option>
                  <option
                    *ngFor="let x of backtrail"
                    [value]="x.approvalTrailId"
                  >
                    {{ x.fromApprovalLevelName }} -- {{ x.staffName }}
                  </option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <div class="col-md-12">
                <label for="comment">Comment/Recommendation</label>
              </div>
              <div class="col-md-12">
                <textarea
                  style="height: 87px"
                  name="comment"
                  formControlName="comment"
                  id="comment"
                  class="form-control"
                  [ngClass]="
                    !commentForm.controls['comment'].valid
                      ? 'required-input'
                      : 'valid-input'
                  "
                ></textarea>
              </div>
            </div>

            <div
              class="form-group"
              *ngIf="isBusiness === false && forwardAction !== 5"
            >
              <label for="" class="col-md-12">Decision</label>
              <div class="col-md-6">
                <select
                  name="vote"
                  formControlName="vote"
                  [ngClass]="
                    !commentForm.controls['vote'].valid
                      ? 'required-input'
                      : 'valid-input'
                  "
                  id="vote"
                  class="form-control"
                >
                  <option value="">-- Select Decision --</option>
                  <option value="1">No</option>
                  <option value="2">Yes</option>
                  <option *ngIf="isBoard == true" value="3">
                    No with condition
                  </option>
                  <option *ngIf="isBoard == false" value="4">
                    Yes with condition
                  </option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>
    </form>

    <div class="panel-footer">
      <div class="row">
        <div class="col-md-12">
          <button
            type="button"
            (click)="forwardCam(commentForm)"
            [disabled]="commentForm.invalid"
            class="btn btn-success pull-right"
          >
            <span
              class="glyphicon glyphicon-send"
              style="padding-right: 4px"
            ></span>
            Save and Send
          </button>
          <button
            type="button"
            (click)="cancelForm()"
            style="margin-right: 5px"
            class="btn btn-danger pull-right"
          >
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>
</p-dialog>
