<div class="ui-g">
    <div class="ui-g-12 no-padding">
        <div class="card no-padding">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-md-12">
                            <h2 class="panel-title pull-left">
                                Products
                            </h2>
                        </div>
                    </div>

                </div>
                <div class="panel-body">
                    <p-dataTable [paginator]="true" [rows]="15" [value]="productApprovalData" [responsive]=true selectionMode="single">
                        <p-column [style]="{'width':'110px'}" field="productCode" header="Code" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                        <p-column field="productName" header="Product Name" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                        <p-column field="productCategoryName" header="Product Category" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                        <p-column field="productTypeName" header="Product Type" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                        <p-column field="productGroupName" header="Product Group" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>

                        <p-column [style]="{'width':'60px'}">

                            <ng-template pTemplate="header">
                                View
                            </ng-template>
                            <ng-template let-prod="rowData" let-i="rowIndex" pTemplate="body">
                                <a (click)="viewProductDetails(prod, $event)" style="display: block" href="#">
                                    <i class="glyphicon glyphicon-eye-open"></i>
                                </a>
                            </ng-template>
                        </p-column>
                    </p-dataTable>
                </div>
            </div>
        </div>
    </div>
</div>

<p-dialog [responsive]=true [(visible)]="displayProductModal" modal="modal" showEffect="fade" width="900">
    <div style="margin-bottom:0" class="panel panel-default">
        <div class="panel-heading">
            <h2 class="panel-title">
                Product Approval
            </h2>
        </div>

        <div class="panel-body">

            <p-tabView (onChange)="handleChange($event)" [activeIndex]="activeIndex">
                <p-tabPanel header="Product Info">
                    <table class="table-customer-information">
                        <tbody>
                            <tr>
                                <td><strong>Name</strong></td>
                                <td>{{selectedProductData.productName}}</td>
                                <td><strong>Product Code</strong></td>
                                <td>{{selectedProductData.productCode}}</td>
                            </tr>
                            <tr>
                                <td><strong>Product Type</strong></td>
                                <td>{{selectedProductData.productTypeName}}</td>
                                <td><strong>Product Group</strong></td>
                                <td>{{selectedProductData.productGroupName}}</td>
                            </tr>
                            <tr>
                                <td><strong>Product Category</strong></td>
                                <td>{{selectedProductData.productCategoryName}}</td>
                                <td><strong>Product Class</strong></td>
                                <td>{{selectedProductData.productClassName}}</td>
                            </tr>
                            <tr>
                                <td><strong>Price Index</strong></td>
                                <td>{{selectedProductData.productPriceIndexName}}</td>
                                <td><strong>Price Index Spread</strong></td>
                                <td>{{selectedProductData.productPriceIndexSpread}}</td>
                            </tr>
                            <tr>
                                <td><strong>Deal Type</strong></td>
                                <td>{{selectedProductData.dealTypeName}}</td>
                                <td><strong>Deal Classification</strong></td>
                                <td>{{selectedProductData.dealClassificationName}}</td>
                            </tr>
                            <tr *ngIf="selectedProductData.principalBalanceGlCode || selectedProductData.interestIncomeExpenseGlCode">
                                <td><strong>Principal Balance GL</strong></td>
                                <td>{{selectedProductData.principalBalanceGlCode}}</td>
                                <td><strong>Interest Income/Expense GL</strong></td>
                                <td>{{selectedProductData.interestIncomeExpenseGlCode}}</td>
                            </tr>
                            <!-- <tr *ngIf="selectedProductData.principalBalanceGl2Code || selectedProductData.productBehaviorId">
                                <td><strong>Principal Balance GL 2 </strong></td>
                                <td>{{selectedProductData.principalBalanceGl2Code}}</td>
                                <td><strong>Allow Fund Usage</strong></td>
                                <td>
                                    <span *ngIf="selectedProductData.ProductBehaviour.allowFundUsage"></span>
                                    <span *ngIf="!selectedProductData.ProductBehaviour.allowFundUsage"></span>
                                </td>
                            </tr> -->
                            <tr *ngIf="selectedProductData.interestReceivablePayableGlCode || selectedProductData.dormantGlCode">
                                <td><strong>Interest Recievable/Payable GL</strong></td>
                                <td>{{selectedProductData.interestReceivablePayableGlCode}}</td>
                                <td><strong>Dormant GL</strong></td>
                                <td>{{selectedProductData.dormantGlCode}}</td>
                            </tr>
                            <tr *ngIf="selectedProductData.premiumDiscountGlCode || selectedProductData.dayCountName">
                                <td><strong>Premium Discount GL</strong></td>
                                <td>{{selectedProductData.premiumDiscountGlCode}}</td>
                                <td><strong>Day Count</strong></td>
                                <td>{{selectedProductData.dayCountName}}</td>
                            </tr>
                            <tr >
                                <td><strong>Collateral LCY Limit </strong></td>
                                <td>
                                    <span *ngIf="selectedProductData.collateralLCYLimit != null"> {{selectedProductData.collateralLCYLimit }}</span>
                                    <span *ngIf="selectedProductData.collateralLCYLimit == null"> n/a</span>
                                </td>
                                <td><strong>Collateral FCY Limit </strong></td>
                                <td>
                                    <span *ngIf="selectedProductData.collateralFCYLimit != null"> {{selectedProductData.collateralFCYLimit }}</span>
                                    <span *ngIf="selectedProductData.collateralFCYLimit == null"> n/a</span>
                                </td>
                            </tr>
                            <tr >
                                <td><strong>Customer Limit </strong></td>
                                <td>
                                    <span *ngIf="selectedProductData.customerLimit != null"> {{selectedProductData.customerLimit }}</span>
                                    <span *ngIf="selectedProductData.customerLimit == null"> n/a</span>
                                </td>
                                <td><strong>Product Limit</strong></td>
                                <td>
                                    <span *ngIf="selectedProductData.productLimit != null"> {{selectedProductData.productLimit }}</span>
                                    <span *ngIf="selectedProductData.productLimit == null"> n/a</span>
                                </td>
                            </tr>

                            <tr >
                                <td><strong>Invoice Limit </strong></td>
                                <td>
                                    <span *ngIf="selectedProductData.invoiceLimit != null"> {{selectedProductData.invoiceLimit }}</span>
                                    <span *ngIf="selectedProductData.invoiceLimit == null"> n/a</span>
                                </td>
                                <td><strong></strong></td>
                                <td>
                                    <span ></span>
                                    <span > </span>
                                </td>
                            </tr>

                            <tr >
                                <td><strong>Is Invoice Based? </strong></td>
                                <td>
                                    <span *ngIf="selectedProductData.invoiceBased">Yes</span>
                                    <span *ngIf="!selectedProductData.invoiceBased || selectedProductData.invoiceBased == null">No</span>
                                </td>
                                <td><strong>Allow Fund Usage</strong></td>
                                <td>
                                    <span *ngIf="selectedProductData.allowFundUsage">Yes</span>
                                    <span *ngIf="!selectedProductData.allowFundUsage || selectedProductData.allowFundUsage == null">No</span>
                                </td>
                            </tr>
                            <tr *ngIf="selectedProductData.productBehaviorId || selectedProductData.allowCustomerAccountForceDebit ">
                                <td><strong>Product Behaviour Type</strong></td>
                                <td>{{selectedProductData.productBehaviorName}}</td>
                                <td><strong>Allow Account Force Debit</strong></td>
                                <td>{{selectedProductData.allowCustomerAccountForceDebit}}</td>
                            </tr>
                            <tr *ngIf="selectedProductData.allowMoratorium || selectedProductData.allowScheduleTypeOverride">
                                <td><strong>Allow Moratorium</strong></td>
                                <td>{{selectedProductData.allowMoratorium}}</td>
                                <td><strong>Allow Schedule Type Override</strong></td>
                                <td>{{selectedProductData.allowScheduleTypeOverride}}</td>
                            </tr>
                            <tr *ngIf="selectedProductData.allowTenor || selectedProductData.allowRate">
                                <td><strong>Allow Tenor Override</strong></td>
                                <td>{{selectedProductData.allowTenor}}</td>
                                <td><strong>Allow Rate Override</strong></td>
                                <td>{{selectedProductData.allowRate}}</td>
                            </tr>
                            <tr *ngIf="selectedProductData.cleanupPeriod || selectedProductData.defaultGracePeriod">
                                <td><strong>Clean Up Period</strong></td>
                                <td>{{selectedProductData.cleanupPeriod}}</td>
                                <td><strong>Default Grace Period</strong></td>
                                <td>{{selectedProductData.defaultGracePeriod}}</td>
                            </tr>
                            <tr *ngIf="selectedProductData.equityContribution || selectedProductData.expiryPeriod">
                                <td><strong>Equity Contribution</strong></td>
                                <td>{{selectedProductData.equityContribution}}</td>
                                <td><strong>Expiry Period</strong></td>
                                <td>{{selectedProductData.expiryPeriod}}</td>
                            </tr>
                            <tr>
                                <td><strong>Currencies</strong></td>
                                <td>{{selectedProductCurrencies}}</td>
                                <td><strong>Risk Rating</strong></td>
                                <td>{{ selectedProductData.riskRatingName }}</td>

                            </tr>
                            <tr>
                                <td><strong>Comment</strong></td>
                                <td><textarea [ngClass]="!selectedProductData.comment ? 'required-input' : 'valid-input'" class="form-control" [(ngModel)]="selectedProductData.comment" name="comment" cols="30" rows="3"></textarea></td>
                                <td><strong>Status</strong></td>
                                <td>
                                    <select name="approvalStatus" id="approvalStatus" class="form-control" [(ngModel)]="selectedProductData.approvalStatusId" [ngClass]="!selectedProductData.approvalStatusId ? 'required-input' : 'valid-input'">
                                                        <option value="">--- Select Approval Status ---</option>
                                                        <option *ngFor="let item of approvalStatusData" [value]="item.approvalStatusId">{{item.approvalStatusName}}</option>
                                                    </select>
                                </td>
                            </tr>
                        </tbody>

                    </table>
                </p-tabPanel>
                <p-tabPanel header="Product Fees">
                    <table class="table table-responsive table-customer-information">
                        <thead>
                            <tr>
                                <td>
                                    <strong>Fee Name</strong>
                                </td>
                                <td>
                                    <strong>Fee Interval</strong>
                                </td>
                                <td>
                                    <strong>Fee Type</strong>
                                </td>
                                <td>
                                    <strong>Fee Target</strong>
                                </td>
                                <td>
                                    <strong>Gl Account</strong>
                                </td>
                                <td>
                                    <strong>Gl Account Code</strong>
                                </td>
                                <td>
                                    <strong>Rate Value</strong>
                                </td>
                                <td>
                                    <strong>Dependent Amount</strong>
                                </td>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let item of selectedProductData.fees">
                                <td>
                                    {{item.feeName}}
                                </td>
                                <td>
                                    {{item.feeIntervalName}}
                                </td>
                                <td>
                                    {{item.feeTypeName}}
                                </td>
                                <td>
                                    {{item.feeTargetName}}
                                </td>
                                <td>
                                    {{item.glAccountName}}
                                </td>
                                <td>
                                    {{item.glAccountCode}}
                                </td>
                                <td>
                                    {{item.rateValue}}
                                </td>
                                <td>
                                    {{item.dependentAmount}}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </p-tabPanel>
                <p-tabPanel header="Product Collateral">
                    <table class="table table-customer-information">
                        <thead>
                            <tr>
                                <td>
                                    <strong>Collateral Type</strong>
                                </td>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let item of selectedProductData.collaterals">
                                <td>{{item.collateralTypeName}}</td>
                            </tr>
                        </tbody>
                    </table>
                </p-tabPanel>
                <p-tabPanel header="View Approval Workflow">
                    <p-dataTable [value]="approvalWorkflowData" [paginator]="true" [rows]="5" [responsive]="true">
                        <p-column field="requestStaffName" header="Intiated From"></p-column>
                        <p-column field="requestApprovalLevel" header="Initiator Approval Level"></p-column>
                        <p-column field="responseStaffName" header="Directed To"></p-column>
                        <p-column field="responseApprovalLevel" header="Response Approval Level"></p-column>
                        <p-column field="approvalStatus" header="Approval Status"></p-column>
                        <p-column field="comment" header="Comment"></p-column>
                        <p-column field="systemArrivalDate" header="Date of Arrival">
                            <ng-template let-col let-apr="rowData" pTemplate="body">
                                {{apr[col.field] | date: 'medium'}}
                            </ng-template>
                        </p-column>
                        <p-column field="systemResponseDate" header="Date of Response">
                            <ng-template let-col let-apr="rowData" pTemplate="body">
                                {{apr[col.field] | date: 'medium' }}
                            </ng-template>
                        </p-column>
                    </p-dataTable>
                </p-tabPanel>
            </p-tabView>
        </div>
        <div class="panel-footer">
            <div class="row">
                <div class="col-md-12">
                    <div class="btn-group pull-right">
                        <button (click)="hideModal()" type="button" class="btn btn-danger" style="margin-right:5px">Close</button>
                        <button [disabled]="!selectedProductData.comment || !selectedProductData.approvalStatusId" type="button" (click)="goForApproval(selectedProductData)" class="btn btn-success">Submit For Approval</button>
                    </div>

                </div>
            </div>
        </div>

    </div>
</p-dialog>

<app-fintrakbanking-dialog [title]="title" [show]="displayConfirmDialog" [width]="width" [message]="message" (approveEvent)="goForApproval(selectedProductData)" (closeEvent)="cancelApproval()"></app-fintrakbanking-dialog>