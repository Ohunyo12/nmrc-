<div class="ui-g">
    <div class="ui-g-12 no-padding">
        <div class="card no-padding">
            <div *ngIf="!displayInitiationForm" class="panel panel-default">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-md-12">
                            <h2 class="panel-title pull-left">
                                DrawDown Initiation
                            </h2>
                        </div>
                    </div>
                </div>

                <div class="row">

                    <div class="pull-right" style="margin-right:16px;margin-bottom:2px;">
                        <input *ngIf="isMultipleDrawdown" type="search" [(ngModel)]="searchString" id="searchString"
                            name="searchString" placeholder="Search by Reference Number..." aria-label="Search"
                            size="30" minlength="4" maxlength="50">
                        <button *ngIf="isMultipleDrawdown" (click)="getApplicationFacilities()">Search</button>

                        <input type="checkbox" (change)="setMultipleDrawdown($event.target.checked)"
                            name="multipleDrawdown">
                        <label for="multipleDrawdown"> Use Multiple Drawdown</label>
                    </div>
                </div>
                <div *ngIf="isMultipleDrawdown && multiplefacilities != null" class="panel-body">
                    <div class="card no-padding">
                        <div class="card no-padding">
                            <!-- resizableColumns="true" -->
                            <p-dataTable [paginator]="false" [responsive]="true" [value]="multiplefacilities"
                                selectionMode="multiplefacilities" (onRowSelect)="pushSelectedLoans($event)"
                                (onRowUnselect)="popSelectedLoans($event)">
                                <p-header>Multiple Facility Drawdown</p-header>
                                <p-column [style]="{'width':'38px'}" selectionMode="multiple"></p-column>

                                <!-- <p-column field="availmentDate" header="Availed On" [filter]="true" filterMatchMode="contains">
                                       <ng-template let-i="rowIndex" let-row="rowData" pTemplate type="body">
                                        {{ row.availmentDate | date}}
                                          </ng-template>
                                </p-column> -->

                                <!-- <p-column field="systemArrivalDate" header="Availed On" [filter]="true" filterMatchMode="contains">
                                    <ng-template let-i="rowIndex" let-row="rowData" pTemplate type="body">
                                        <span *ngIf="row.availmentDate != null">{{ row.availmentDate | date}}</span>
                                        <span *ngIf="row.availmentDate == null">{{ row.availmentDate | date}}</span>
                                    </ng-template>
                                </p-column> -->

                                <!-- <p-column field="loanTypeName" header="Type" sortable="true" [filter]="true" filterMatchMode="contains"></p-column> -->
                                <p-column [style]="{'width':'150px'}" field="productTypeName" header="Facility Type"
                                    sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                <p-column [style]="{'width':'150px'}" field="productName" header="Facility Name"
                                    sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                <p-column field="applicationReferenceNumber" header="Ref No" sortable="true"
                                    [filter]="true" filterMatchMode="contains"></p-column>
                                <p-column [style]="{'width':'150px'}" field="customerName" header="Obligor Name"
                                    sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        <span *ngIf="item.loanTypeId == 3">{{item.applicantName}}</span>
                                        <span *ngIf="item.loanTypeId != 3">{{item.customerName}}</span>
                                    </ng-template>
                                </p-column>
                                <p-column [style]="{'text-align':'right','width':'115px'}" field="approvedAmount"
                                    header="Approved Amount" sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.approvedAmount | currency:item.currencyCode:true: '1.2-2'}}
                                    </ng-template>
                                </p-column>
                                <p-column [style]="{'text-align':'right','width':'115px'}" field="amountDisbursed"
                                    header="Disbursed Amount" sortable="true" [filter]="true"
                                    filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.amountDisbursed | currency:item.currencyCode:true: '1.2-2'}}
                                    </ng-template>
                                </p-column>
                                <p-column [style]="{'text-align':'right','width':'115px'}" field="allRequestAmount"
                                    header="Requested Amount" sortable="true" [filter]="true"
                                    filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.allRequestAmount | currency:item.currencyCode:true: '1.2-2'}}
                                    </ng-template>
                                </p-column>

                                <p-column [style]="{'width':'50px'}" field="interestRate" header="Interest"
                                    [filter]="true" filterMatchMode="contains"></p-column>
                                <p-column [style]="{'width':'80px'}" field="approvedTenor" header="Tenor"
                                    sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.approvedTenorString}}
                                    </ng-template>
                                </p-column>
                            </p-dataTable>

                            <div *ngIf="showProceedButtton" class="col-md-12 ">
                                <button type="button" (click)="proceedFirstOfSelectedMultiples()"
                                    style="margin-right:5px"
                                    class="btn btn-info btn-lg btn-block text-uppercase waves-effect waves-light">Proceed</button>
                            </div>

                        </div>
                    </div>
                </div>
                <div *ngIf="!isMultipleDrawdown" class="panel-body">
                    <div class="card no-padding">
                        <div class="card no-padding">
                            <p-dataTable [paginator]="true" [responsive]="true" [value]="loans" [rows]="5"
                                selectionMode="single" (onRowSelect)="onSelectedLoanChange($event.data)">
                                <p-header>APPROVED FACIITIES</p-header>
                                <p-column [style]="{'width':'38px'}" selectionMode="single"></p-column>
                                <p-column [style]="{'width':'100px'}" field="availmentDate" header="Date Recieved"
                                    sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template let-i="rowIndex" let-row="rowData" pTemplate type="body">
                                        <span *ngIf="row.availmentDate != null">{{ row.availmentDate | date: 'medium'
                                            }}</span>
                                        <span *ngIf="row.availmentDate == null"> N/A </span>
                                    </ng-template>
                                </p-column>
                                <p-column [style]="{'width':'100px'}" field="loanTypeName" header="Type" sortable="true"
                                    [filter]="true" filterMatchMode="contains"></p-column>

                                <p-column [style]="{'width':'70px'}" field="productTypeName" header="Facility Type"
                                    sortable="true" [filter]="true" filterMatchMode="contains"></p-column>

                                <p-column [style]="{'width':'70px'}" field="productClassName" header="Class"
                                    sortable="true" [filter]="true" filterMatchMode="contains"></p-column>

                                <p-column [style]="{'width':'100px'}" field="applicationReferenceNumber" header="Ref No"
                                    sortable="true" [filter]="true" filterMatchMode="contains"></p-column>

                                <p-column [style]="{'width':'50px'}" field="isLineFacilityString" header="Is A Line"
                                    sortable="true" [filter]="true" filterMatchMode="contains"></p-column>

                                <p-column [style]="{'width':'100px'}" field="customerName" header="Obligor Name"
                                    sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        <span *ngIf="item.loanTypeId == 3">{{item.applicantName}}</span>
                                        <span *ngIf="item.loanTypeId != 3">{{item.customerName}}</span>
                                    </ng-template>
                                </p-column>
                                <p-column [style]="{'text-align':'right','width':'100px'}" field="approvedAmount"
                                    header="Approved Amount" sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.approvedAmount | currency:item.currencyCode:true: '1.2-2'}}
                                    </ng-template>
                                </p-column>

                                <p-column [style]="{'text-align':'right','width':'100px'}" field="amountDisbursed"
                                    header="Disbursed Amount" sortable="true" [filter]="true"
                                    filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.amountDisbursed | currency:item.currencyCode:true: '1.2-2'}}
                                    </ng-template>
                                </p-column>
                                <p-column [style]="{'text-align':'right','width':'120px'}" field="allRequestAmount"
                                    header="Requested Amount" sortable="true" [filter]="true"
                                    filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.allRequestAmount | currency:item.currencyCode:true: '1.2-2'}}
                                    </ng-template>
                                </p-column>
                                <p-column [style]="{'width':'50px'}" field="interestRate" header="Interest"
                                    [filter]="true" filterMatchMode="contains"></p-column>
                                <p-column [style]="{'width':'80px'}" field="approvedTenor" header="Tenor"
                                    sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.approvedTenorString}}
                                    </ng-template>
                                </p-column>

                                <p-column [style]="{'width':'100px'}" field="approvalStatusName"
                                    header="Approval Status" [filter]="true" filterMatchMode="contains">
                                </p-column>
                            </p-dataTable>
                        </div>

                        <p-accordion #accordion1>
                            <p-accordionTab [selected]="true"
                                header="Approved Employer Related Requests For Draw-down Initiation">
                                <div class="pull-right" style="margin-right:16px;margin-bottom:2px;">
                                    <input type="search" [(ngModel)]="EmployerSearchString" id="EmployerSearchString"
                                        name="EmployerSearchString" placeholder="Search loan application(s)..."
                                        aria-label="Search" size="50" minlength="2" maxlength="50">
                                    <button (click)="getGlobalApprovedEmployerApplications()">Search</button>
                                    <button (click)="resetEmployerRelatedLoans()" title="Refresh">
                                        <span class="glyphicon glyphicon-refresh"></span>
                                    </button>
                                </div>
                                <br />
                                <br />

                                <div class="card no-padding">
                                    <p-dataTable [paginator]="true" [responsive]="true" [value]="employerRelatedLoans"
                                        [rows]="5" selectionMode="single"
                                        (onRowSelect)="onSelectedLoanChange($event.data)">
                                        <p-header>APPROVED EMPLOYER RELATED FACIITIES</p-header>
                                        <p-column [style]="{'width':'38px'}" selectionMode="single"></p-column>
                                        <p-column [style]="{'width':'100px'}" field="availmentDate"
                                            header="Date Recieved" [filter]="true" filterMatchMode="contains">
                                            <ng-template let-i="rowIndex" let-row="rowData" pTemplate type="body">
                                                <span *ngIf="row.availmentDate != null">{{ row.availmentDate | date:
                                                    'medium' }}</span>
                                                <span *ngIf="row.availmentDate == null"> N/A </span>
                                            </ng-template>
                                        </p-column>
                                        <p-column [style]="{'width':'100px'}" field="loanTypeName" header="Type"
                                            sortable="true" [filter]="true" filterMatchMode="contains"></p-column>

                                        <p-column [style]="{'width':'70px'}" field="productTypeName"
                                            header="Facility Type" sortable="true" [filter]="true"
                                            filterMatchMode="contains"></p-column>

                                        <p-column [style]="{'width':'70px'}" field="productClassName" header="Class"
                                            sortable="true" [filter]="true" filterMatchMode="contains"></p-column>

                                        <p-column [style]="{'width':'100px'}" field="applicationReferenceNumber"
                                            header="Ref No" sortable="true" [filter]="true" filterMatchMode="contains">
                                        </p-column>

                                        <p-column [style]="{'width':'50px'}" field="isLineFacilityString"
                                            header="Is A Line" sortable="true" [filter]="true"
                                            filterMatchMode="contains"></p-column>

                                        <p-column [style]="{'width':'100px'}" field="customerName" header="Obligor Name"
                                            sortable="true" [filter]="true" filterMatchMode="contains">
                                            <ng-template pTemplate="body" let-item="rowData">
                                                <span *ngIf="item.loanTypeId == 3">{{item.applicantName}}</span>
                                                <span *ngIf="item.loanTypeId != 3">{{item.customerName}}</span>
                                            </ng-template>
                                        </p-column>
                                        <p-column [style]="{'text-align':'right','width':'100px'}"
                                            field="approvedAmount" header="Approved Amount" sortable="true"
                                            [filter]="true" filterMatchMode="contains">
                                            <ng-template pTemplate="body" let-item="rowData">
                                                {{item.approvedAmount | currency:item.currencyCode:true: '1.2-2'}}
                                            </ng-template>
                                        </p-column>

                                        <p-column [style]="{'text-align':'right','width':'100px'}"
                                            field="amountDisbursed" header="Disbursed Amount" sortable="true"
                                            [filter]="true" filterMatchMode="contains">
                                            <ng-template pTemplate="body" let-item="rowData">
                                                {{item.amountDisbursed | currency:item.currencyCode:true: '1.2-2'}}
                                            </ng-template>
                                        </p-column>
                                        <p-column [style]="{'text-align':'right','width':'120px'}"
                                            field="allRequestAmount" header="Requested Amount" sortable="true"
                                            [filter]="true" filterMatchMode="contains">
                                            <ng-template pTemplate="body" let-item="rowData">
                                                {{item.allRequestAmount | currency:item.currencyCode:true: '1.2-2'}}
                                            </ng-template>
                                        </p-column>
                                        <p-column [style]="{'width':'50px'}" field="interestRate" header="Interest"
                                            [filter]="true" filterMatchMode="contains"></p-column>
                                        <p-column [style]="{'width':'80px'}" field="approvedTenor" header="Tenor"
                                            sortable="true" [filter]="true" filterMatchMode="contains">
                                            <ng-template pTemplate="body" let-item="rowData">
                                                {{item.approvedTenorString}}
                                            </ng-template>
                                        </p-column>

                                        <p-column [style]="{'width':'100px'}" field="approvalStatusName"
                                            header="Approval Status" [filter]="true" filterMatchMode="contains">
                                        </p-column>
                                    </p-dataTable>
                                </div>
                            </p-accordionTab>
                        </p-accordion>
                        <br />

                        <div class="card no-padding">
                            <p-dataTable [paginator]="true" [responsive]="true" [value]="referedDrawdownItems"
                                [rows]="5" selectionMode="single" (onRowSelect)="onSelectedLoanChange($event.data)">
                                <p-header>REFERED REQUEST</p-header>
                                <p-column [style]="{'width':'38px'}" selectionMode="single"></p-column>
                                <p-column [style]="{'width':'100px'}" field="systemArrivalDate" header="Date Received"
                                    [filter]="true" filterMatchMode="contains">
                                    <ng-template let-i="rowIndex" let-row="rowData" pTemplate type="body">
                                        <span *ngIf="row.availmentDate != null">{{ row.availmentDate | date}}</span>
                                        <span *ngIf="row.availmentDate == null"> N/A </span>
                                    </ng-template>
                                </p-column>
                                <p-column [style]="{'width':'100px'}" field="loanTypeName" header="Type" sortable="true"
                                    [filter]="true" filterMatchMode="contains"></p-column>

                                <p-column [style]="{'width':'70px'}" field="productTypeName" header="Facility Type"
                                    sortable="true" [filter]="true" filterMatchMode="contains"></p-column>

                                <p-column [style]="{'width':'70px'}" field="productClassName" header="Class"
                                    sortable="true" [filter]="true" filterMatchMode="contains"></p-column>

                                <p-column [style]="{'width':'100px'}" field="applicationReferenceNumber" header="Ref No"
                                    sortable="true" [filter]="true" filterMatchMode="contains"></p-column>

                                <p-column [style]="{'width':'100px'}" field="customerName" header="Obligor Name"
                                    sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        <span *ngIf="item.loanTypeId == 3">{{item.applicantName}}</span>
                                        <span *ngIf="item.loanTypeId != 3">{{item.customerName}}</span>
                                    </ng-template>
                                </p-column>
                                <p-column [style]="{'text-align':'right','width':'100px'}" field="approvedAmount"
                                    header="Approved Amount" sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.approvedAmount | currency:item.currencyCode:true: '1.2-2'}}
                                    </ng-template>
                                </p-column>

                                <p-column [style]="{'text-align':'right','width':'100px'}" field="amountDisbursed"
                                    header="Disbursed Amount" sortable="true" [filter]="true"
                                    filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.amountDisbursed | currency:item.currencyCode:true: '1.2-2'}}
                                    </ng-template>
                                </p-column>
                                <p-column [style]="{'text-align':'right','width':'120px'}" field="allRequestAmount"
                                    header="Requested Amount" sortable="true" [filter]="true"
                                    filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.allRequestAmount | currency:item.currencyCode:true: '1.2-2'}}
                                    </ng-template>
                                </p-column>
                                <p-column [style]="{'width':'50px'}" field="interestRate" header="Interest"
                                    [filter]="true" filterMatchMode="contains"></p-column>
                                <p-column [style]="{'width':'80px'}" field="approvedTenor" header="Tenor"
                                    sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.approvedTenorString}}
                                    </ng-template>
                                </p-column>

                                <p-column [style]="{'width':'100px'}" field="approvalStatusName"
                                    header="Approval Status" [filter]="true" filterMatchMode="contains">
                                </p-column>
                            </p-dataTable>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="displayInitiationForm" style="margin-bottom:0" class="panel panel-default">
                <div class="panel-heading">
                    <h2 class="panel-title">
                        Draw down Initiation for
                        <strong>
                            <span *ngIf="loanTypeId == 3">{{ applicantName }}</span>
                            <span *ngIf="loanTypeId != 3">{{ customerName }}</span>
                        </strong>
                    </h2>
                    <div class="pull-right">
                        <a class="close" (click)="closeDialog()">&times;</a>
                    </div>
                </div>
                <form novalidate [formGroup]="initiationForm" autocomplete="off">
                    <p-tabView>
                        <p-tabPanel header="Customer Request">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <h2 class="panel-title pull-left">
                                                DrawDown Request Details <i *ngIf="isProspective"
                                                    style="color: red; font-size: small;">(this customer is a
                                                    Prospective Customer)</i>
                                            </h2>
                                            <div class="pull-right">
                                                <button pButton type="button" (click)="fetchAndAddCustomerAccounts()"
                                                    label="Refresh Customer Accounts" class="ui-button-info">
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-body">
                                    <p-dataTable *ngIf="isMultipleDrawdown" [paginator]="false" resizableColumns="true"
                                        [responsive]="true" [value]="drawdownFacilitiesInformation"
                                        selectionMode="single" (onRowSelect)="onSelectedLoanChange($event.data)"
                                        (onRowUnselect)="popSelectedLoans($event)">
                                        <p-header>Multiple Facility Drawdown</p-header>
                                        <!-- <p-column [style]="{'width':'38px'}" selectionMode="multiple"></p-column> -->
                                        <p-column [style]="{'width':'150px'}" field="productTypeName"
                                            header="Facility Type" sortable="true" [filter]="true"
                                            filterMatchMode="contains"></p-column>
                                        <p-column [style]="{'width':'150px'}" field="productName" header="Facility Name"
                                            sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                        <p-column field="applicationReferenceNumber" header="Ref No" sortable="true"
                                            [filter]="true" filterMatchMode="contains"></p-column>
                                        <p-column [style]="{'width':'150px'}" field="customerName" header="Obligor Name"
                                            sortable="true" [filter]="true" filterMatchMode="contains">
                                            <ng-template pTemplate="body" let-item="rowData">
                                                <span *ngIf="item.loanTypeId == 3">{{item.applicantName}}</span>
                                                <span *ngIf="item.loanTypeId != 3">{{item.customerName}}</span>
                                            </ng-template>
                                        </p-column>
                                        <p-column [style]="{'text-align':'right','width':'115px'}"
                                            field="approvedAmount" header="Approved Amount" sortable="true"
                                            [filter]="true" filterMatchMode="contains">
                                            <ng-template pTemplate="body" let-item="rowData">
                                                {{item.approvedAmount | currency:item.currencyCode:true: '1.2-2'}}
                                            </ng-template>
                                        </p-column>
                                        <p-column [style]="{'text-align':'right','width':'115px'}"
                                            field="amountDisbursed" header="Disbursed Amount" sortable="true"
                                            [filter]="true" filterMatchMode="contains">
                                            <ng-template pTemplate="body" let-item="rowData">
                                                {{item.amountDisbursed | currency:item.currencyCode:true: '1.2-2'}}
                                            </ng-template>
                                        </p-column>
                                        <p-column [style]="{'text-align':'right','width':'115px'}"
                                            field="allRequestAmount" header="Requested Amount" sortable="true"
                                            [filter]="true" filterMatchMode="contains">
                                            <ng-template pTemplate="body" let-item="rowData">
                                                {{item.allRequestAmount | currency:item.currencyCode:true: '1.2-2'}}
                                            </ng-template>
                                        </p-column>
                                        <p-column [style]="{'text-align':'right','width':'115px'}"
                                            field="bookingAmountRequested" header="New Request Amount" sortable="true"
                                            [filter]="true" filterMatchMode="contains">
                                            <ng-template pTemplate="body" let-item="rowData">
                                                {{item.bookingAmountRequested ? item.bookingAmountRequested : 0 |
                                                currency:item.currencyCode:true: '1.2-2'}}
                                            </ng-template>
                                        </p-column>
                                        <p-column [style]="{'width':'50px'}" field="interestRate" header="Interest"
                                            [filter]="true" filterMatchMode="contains"></p-column>
                                        <p-column [style]="{'width':'80px'}" field="approvedTenor" header="Tenor"
                                            sortable="true" [filter]="true" filterMatchMode="contains">
                                            <ng-template pTemplate="body" let-item="rowData">
                                                {{item.approvedTenorString}}
                                            </ng-template>
                                        </p-column>
                                    </p-dataTable>
                                </div>
                                <div class="panel-body">
                                    <div class="form-horizontal">
                                        <div *ngIf="showBeneficiary" class="form-group">
                                            <label for="productId" class="control-label col-md-2">Beneficiary</label>
                                            <div class="col-md-8">
                                                <strong>{{selectedBeneficiary.toUpperCase()}}</strong>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="productId" class="control-label col-md-2">Product</label>
                                            <div class="col-md-8">
                                                <select name="productId" id="productId" formControlName="productId"
                                                    class="form-control"
                                                    [ngClass]="!initiationForm.controls['productId'].valid ? 'required-input' : 'valid-input'">
                                                    <option value="">-- Select Product --</option>
                                                    <option *ngFor="let x of filteredProducts" [value]="x.productId">
                                                        {{ x.productName }}</option>
                                                </select>
                                            </div>
                                        </div>
                                        <!-- <div *ngIf="!isMultipleDrawdown" class="form-group">
                                            <label for="documentTitle" class="control-label col-md-2">Document
                                                Title</label>
                                            <div class="col-md-8 no-data-div">
                                                <input type="text" [(ngModel)]="uploadFileTitle" class="form-control"
                                                    name="docDescription" formControlName="docDescription"
                                                    [ngClass]="initiationForm.controls['docDescription'].valid ? 'valid-input' : 'required-input'"
                                                    placeholder="Customer Request Document">
                                            </div>
                                        </div> -->
                                        <!-- <div *ngIf="!isMultipleDrawdown" class="form-group">
                                            <label for="document" class="control-label col-md-2">Select Document</label>
                                            <div class="col-md-8">
                                              <input type="file"
                                                     formControlName="fileInput"
                                                     (change)="onFileChange($event)"
                                                     accept=".pdf,.doc,.docx,.jpg,.jpeg"
                                                     class="form-control"
                                                     [ngClass]="initiationForm.controls['fileInput'].invalid && initiationForm.controls['fileInput'].touched ? 'required-input' : 'valid-input'">
                                              <div class="text-danger" *ngIf="initiationForm.controls['fileInput'].invalid && initiationForm.controls['fileInput'].touched">
                                                Document selection is required.
                                              </div>
                                            </div>
                                          </div>                                           -->
                                        <div class="form-group">
                                            <label for="approvedAmount" class="control-label col-md-2">Approved Amount
                                                ({{loanSelection.currencyCode}})</label>
                                            <div class="col-md-8">
                                                <input type="text" [attr.disabled]="true" formartM class="form-control"
                                                    name="approvedAmount" formControlName="approvedAmount"
                                                    [ngClass]="initiationForm.controls['approvedAmount'].valid ? 'valid-input' : 'required-input'"
                                                    class="form-control" placeholder="0.00">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="availableAmount" class="control-label col-md-2">Available
                                                Amount ({{loanSelection.currencyCode}})</label>
                                            <div class="col-md-8">
                                                <input type="text" [attr.disabled]="true" formartM class="form-control"
                                                    name="availableAmount" formControlName="availableAmount"
                                                    [ngClass]="initiationForm.controls['availableAmount'].valid ? 'valid-input' : 'required-input'"
                                                    class="form-control" placeholder="0.00">
                                            </div>
                                        </div>

                                        <!-- <div class="form-group">
                                            <label for="tenor" class="control-label col-md-2">Tenor
                                            </label>
                                            <div class="col-md-8">
                                                <input type="text" (blur)="validateTenor($event.target.value)" formartM class="form-control" name="tenor"
                                                    formControlName="tenor">
                                            </div>
                                        </div> -->


                                        <div class="form-group">
                                            <label for="amountToBook" class="control-label col-md-2">New Request Amount
                                                ({{loanSelection.currencyCode}})</label>
                                            <div class="col-md-8">
                                                <input type="text" formartM class="form-control"
                                                    (blur)="formatFeeValue()" [(ngModel)]="data.bookingAmount"
                                                    name="amountToBook" formControlName="amountToBook"
                                                    [ngClass]="initiationForm.controls['amountToBook'].valid ? 'valid-input' : 'required-input'"
                                                    class="form-control" placeholder="0.00">
                                            </div>
                                        </div>


                                        <div *ngIf="!isMultipleDrawdown" class="form-group">
                                            <label for="casaAccountId" *ngIf="!isChecked"
                                                class="control-label col-md-2">{{casaAccountText}}</label>
                                            <label for="casaAccountId" *ngIf="isChecked"
                                                class="control-label col-md-2">{{casaAccountTextProjectRelated}}</label>
                                            <div class="col-md-8">
                                                <select (change)="onCustomerAccountChange($event.target.value)"
                                                    name="casaAccountId" id="casaAccountId"
                                                    formControlName="casaAccountId" class="form-control"
                                                    [ngClass]="!initiationForm.controls['casaAccountId'].valid ? 'required-input' : 'valid-input'">
                                                    <option value="">-- Select Customer Account --</option>
                                                    <option *ngFor="let x of customerAccounts"
                                                        [value]="x.casaAccountId">{{ x.productAccountNumber }}</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div *ngIf="isMultipleDrawdown" class="form-group">
                                            <label for="document" class="control-label col-md-2"></label>
                                            <div class="col-md-4">
                                                <button (click)="SaveActiveRecordAmount(initiationForm)"
                                                    class="btn btn-sm btn-primary"
                                                    [disabled]="(initiationForm.value.amountToBook == null ) "><span></span>
                                                    Save Adjustment
                                                </button>
                                            </div>
                                        </div>
                                        <!-- <div *ngIf="(isCommercialLoan || isIDF) && !isMultipleDrawdown" class="form-group">
                                            <label for="casaAccountId2" class="control-label col-md-2">{{casaAccount2Text}}2</label>
                                            <div class="col-md-8">
                                                <select (change)="onCustomerAccountChange($event.target.value)" name="casaAccountId2" id="casaAccountId2" formControlName="casaAccountId2"
                                                    class="form-control" [ngClass]="!initiationForm.controls['casaAccountId2'].valid ? 'required-input' : 'valid-input'">
                                                    <option value="">-- Select Customer Account --</option>
                                                    <option *ngFor="let x of customerAccounts" [value]="x.casaAccountId">{{ x.productAccountNumber }}</option>
                                                </select>
                                            </div>
                                        </div> -->
                                        <div class="form-group">
                                            <label for="comment" class="control-label col-md-2">Comments:</label>
                                            <div class="col-md-8">
                                                <textarea class="form-control" formControlName="comment"
                                                    [ngClass]="initiationForm.controls['comment'].valid ? 'valid-input' : 'required-input'"
                                                    class="form-control">
                                                </textarea>
                                            </div>
                                        </div>
                                        <div class="form-group"
                                            *ngIf="(loanSelection.isProjectRelate == true && loanSelection.isLineFacility == false) || (loanSelection.isProjectRelate == true && loanSelection.isLineFacility == true && loanSelection.isLineMaintained == true)">
                                            <br />
                                            <div class="form-group">
                                                <label for="isProjectRelated" class="control-label col-md-2">Project
                                                    Related:</label>
                                                <div class="col-md-8">
                                                    <!-- <div class="checkbox-inline actCheckBox"> -->
                                                    <input type="checkbox" formControlName="isProjectRelated"
                                                        (change)="changed($event)" name="isProjectRelated"
                                                        id="isProjectRelated">
                                                    <!-- </div> -->
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group" *ngIf="loanSelection.isEmployerRelated == true">
                                            <label for="" class="control-label col-md-2">Related Employer:</label>
                                            <div class="col-md-8">
                                                <strong>{{ loanSelection?.employer}}</strong>
                                            </div>
                                        </div>

                                        <div *ngIf="!isMultipleDrawdown" class="form-group">
                                            <label for="document" class="control-label col-md-2"></label>
                                            <div class="col-md-8">
                                                <!-- [disabled]="(initiationForm.invalid || !casaAccountSelected || !allLiensArePlaced) "><span -->
                                                <button *ngIf="!(loanBookingRequestId > 0)" (click)="initiateDrawdown()"
                                                    class="btn btn-sm btn-primary"
                                                    [disabled]="(initiationForm.invalid || !casaAccountSelected)"><span
                                                        class="glyphicon glyphicon-book"></span>Initiate
                                                    DrawDown</button>
                                                <button *ngIf="loanBookingRequestId > 0" (click)="initiateDrawdown()"
                                                    class="btn btn-sm btn-primary"
                                                    [disabled]="(initiationForm.invalid || !casaAccountSelected)"><span
                                                        class="glyphicon glyphicon-book"></span>Continue
                                                    DrawDown</button>
                                                <button *ngIf="!(initiationForm.invalid || !casaAccountSelected)"
                                                    type="button" (click)="selectApprover()"
                                                    class="btn btn-default"><span class="glyphicon glyphicon-user"
                                                        style="padding-right:4px;"></span> Select Approver
                                                </button>
                                                <button
                                                    *ngIf="selectedApprover != null && (!(initiationForm.invalid || !casaAccountSelected))"
                                                    type="button" class="btn btn-default"
                                                    style="border-color:transparent;"><i>{{selectedApprover}}</i></button>
                                                <button *ngIf="loanSelection.loanTypeId == 2" type="button"
                                                    (click)="selectMember()" class="btn btn-default"><span
                                                        class="glyphicon glyphicon-user"
                                                        style="padding-right:4px;"></span> Select Group Member</button>
                                                <button *ngIf="loanSelection.isEmployerRelated == true" type="button"
                                                    (click)="selectCustomerForEmployerRelated()"
                                                    class="btn btn-default"><span class="glyphicon glyphicon-user"
                                                        style="padding-right:4px;"></span> Select Customer</button>
                                                <span *ngIf="isLienPlacementForLoan"
                                                    style="color: red; font-weight: bold;">NOTE: LIEN WILL BE PLACED FOR
                                                    THIS LOAN!</span>
                                            </div>
                                        </div>

                                        <div *ngIf="isMultipleDrawdown">
                                            <hr>
                                            <div class="form-group">
                                                <label for="documentTitle" class="control-label col-md-2">Document
                                                    Title</label>
                                                <div class="col-md-4 no-data-div">
                                                    <input type="text" [(ngModel)]="uploadFileTitle"
                                                        class="form-control" name="docDescription"
                                                        formControlName="docDescription"
                                                        [ngClass]="initiationForm.controls['docDescription'].valid ? 'valid-input' : 'required-input'"
                                                        placeholder="Customer Request Document">
                                                </div>
                                                <label for="document" class="control-label col-md-2">Select
                                                    Document</label>
                                                <div class="col-md-4">
                                                    <input type="file" (change)="onFileChange($event)"
                                                        placeholder="Upload file" accept=".pdf,.doc,.docx,.jpg,.jpeg"
                                                        #fileInput name="fileInput" style="padding-top:2px;"
                                                        class="form-control">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="casaAccountId"
                                                    class="control-label col-md-2">{{casaAccountText}}</label>
                                                <div class="col-md-4">
                                                    <select (change)="onCustomerAccountChange($event.target.value)"
                                                        name="casaAccountId" id="casaAccountId"
                                                        formControlName="casaAccountId" class="form-control"
                                                        [ngClass]="!initiationForm.controls['casaAccountId'].valid ? 'required-input' : 'valid-input'">
                                                        <option value="">-- Select Customer Account --</option>
                                                        <option *ngFor="let x of customerAccounts"
                                                            [value]="x.casaAccountId">{{ x.productAccountNumber }}
                                                        </option>
                                                    </select>
                                                </div>

                                                <label for="casaAccountId2"
                                                    class="control-label col-md-2">{{casaAccount2Text}}2</label>
                                                <div class="col-md-4">
                                                    <select (change)="onCustomerAccountChange($event.target.value)"
                                                        name="casaAccountId2" id="casaAccountId2"
                                                        formControlName="casaAccountId2" class="form-control"
                                                        [ngClass]="!initiationForm.controls['casaAccountId2'].valid ? 'required-input' : 'valid-input'">
                                                        <option value="">-- Select Customer Account --</option>
                                                        <option *ngFor="let x of customerAccounts"
                                                            [value]="x.casaAccountId">{{ x.productAccountNumber }}
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group"
                                                *ngIf="loanSelection != null && loanSelection.isLineFacility == true  && loanSelection.isLineMaintained == false">
                                                <label for="chargeFeeOnce" class="control-label col-md-2"></label>
                                                <div class="col-md-4">
                                                    <label class="checkbox-inline actCheckBox">
                                                        <input type="checkbox" [(ngModel)]="chargeFeeOnce"
                                                            [ngModelOptions]="{standalone: true}" name="chargeFeeOnce"
                                                            id="chargeFeeOnce" value="{{chargeFeeOnce}}">Take fee once
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="form-group"
                                                *ngIf="(loanSelection.isProjectRelate == true && loanSelection.isLineFacility == false) || (loanSelection.isProjectRelate == true && loanSelection.isLineFacility == true && loanSelection.isLineMaintained == true)">
                                                <div class="form-group">
                                                    <div class="col-md-4">
                                                        <div class="checkbox-inline actCheckBox">
                                                            <input type="checkbox" formControlName="isProjectRelated"
                                                                (change)="changed($event)" name="isProjectRelated"
                                                                id="isProjectRelated">
                                                        </div><label class="checkbox">Project Related</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="document" class="control-label col-md-2"></label>
                                                <div class="col-md-4">
                                                    <!-- <button (click)="initiateDrawdown()" class="btn btn-sm btn-primary" [disabled]="(uploadFileTitle==null || file==undefined || initiationForm.invalid || !casaAccountSelected) "><span class="glyphicon glyphicon-book"></span> Initiate DrawDown</button> -->
                                                    <button (click)="initiateDrawdown()" class="btn btn-sm btn-primary"
                                                        [disabled]="( initiationForm.invalid || !casaAccountSelected) "><span
                                                            class="glyphicon glyphicon-book"></span> Initiate
                                                        DrawDown</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                            </div>
                        </p-tabPanel>
                        <p-tabPanel *ngIf="loanSelection != null" header="Loan Request Info">
                            <div class="panel-body">
                                <h5>
                                    <b>Source: </b>{{ loanSource }}
                                </h5>
                                <p-dataTable *ngIf="isMultipleDrawdown" [paginator]="false" resizableColumns="true"
                                    [responsive]="true" [value]="drawdownFacilitiesInformation" selectionMode="single"
                                    (onRowSelect)="pushSelectedLoans($event)"
                                    (onRowUnselect)="popSelectedLoans($event)">
                                    <p-header>Multiple Facility Drawdown</p-header>
                                    <!-- <p-column [style]="{'width':'38px'}" selectionMode="multiple"></p-column> -->
                                    <p-column [style]="{'width':'150px'}" field="productTypeName" header="Facility Type"
                                        sortable="true" [filter]="true" filterMatchMode="contains"></p-column>



                                    <p-column [style]="{'width':'150px'}" field="productName" header="Facility Name"
                                        sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                    <p-column field="applicationReferenceNumber" header="Ref No" sortable="true"
                                        [filter]="true" filterMatchMode="contains"></p-column>
                                    <p-column [style]="{'width':'150px'}" field="customerName" header="Obligor Name"
                                        sortable="true" [filter]="true" filterMatchMode="contains">
                                        <ng-template pTemplate="body" let-item="rowData">
                                            <span *ngIf="item.loanTypeId == 3">{{item.applicantName}}</span>
                                            <span *ngIf="item.loanTypeId != 3">{{item.customerName}}</span>
                                        </ng-template>
                                    </p-column>
                                    <p-column [style]="{'text-align':'right','width':'115px'}" field="approvedAmount"
                                        header="Approved Amount" sortable="true" [filter]="true"
                                        filterMatchMode="contains">
                                        <ng-template pTemplate="body" let-item="rowData">
                                            {{item.approvedAmount | currency:item.currencyCode:true: '1.2-2'}}
                                        </ng-template>
                                    </p-column>
                                    <p-column [style]="{'text-align':'right','width':'115px'}" field="amountDisbursed"
                                        header="Disbursed Amount" sortable="true" [filter]="true"
                                        filterMatchMode="contains">
                                        <ng-template pTemplate="body" let-item="rowData">
                                            {{item.amountDisbursed | currency:item.currencyCode:true: '1.2-2'}}
                                        </ng-template>
                                    </p-column>
                                    <p-column [style]="{'text-align':'right','width':'115px'}" field="allRequestAmount"
                                        header="Requested Amount" sortable="true" [filter]="true"
                                        filterMatchMode="contains">
                                        <ng-template pTemplate="body" let-item="rowData">
                                            {{item.allRequestAmount | currency:item.currencyCode:true: '1.2-2'}}
                                        </ng-template>
                                    </p-column>
                                    <p-column [style]="{'width':'50px'}" field="interestRate" header="Interest"
                                        [filter]="true" filterMatchMode="contains"></p-column>
                                    <p-column [style]="{'width':'80px'}" field="approvedTenor" header="Tenor"
                                        sortable="true" [filter]="true" filterMatchMode="contains">
                                        <ng-template pTemplate="body" let-item="rowData">
                                            {{item.approvedTenorString}}
                                        </ng-template>
                                    </p-column>
                                </p-dataTable>
                            </div>
                            <div class="panel-body" style="overflow:scroll; height:300px">
                                <table class="table table-customer-information">
                                    <tbody>
                                        <tr>
                                            <td><strong>Application Reference Number</strong></td>
                                            <td>{{ loanSelection.applicationReferenceNumber }}</td>
                                            <td><strong>Loan Type</strong></td>
                                            <td>{{ loanSelection.loanTypeName }}</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Product Name</strong></td>
                                            <td>{{ loanSelection.productName }}</td>
                                            <td><strong>Product Type</strong></td>
                                            <td>{{ loanSelection.productTypeName}}</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Approved Tenor</strong></td>
                                            <td>{{ loanSelection.approvedTenorString }}</td>
                                            <td><strong>Interest Rate</strong></td>
                                            <td>{{ loanSelection.interestRate }}</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Approved Amount</strong></td>
                                            <td>{{loanSelection.approvedAmount |
                                                currency:loanSelection.currencyCode:true: '1.2-2'}}
                                            </td>
                                            <td><strong>Disbursed Amount</strong></td>
                                            <td>{{ loanSelection.amountDisbursed | number: '1.2'}}</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Previous Request</strong></td>
                                            <td>{{ loanSelection.allRequestAmount - loanSelection.requestedAmount |
                                                currency:loanSelection.currencyCode:true: '1.2-2' }}
                                            </td>
                                            <td><strong>New Request</strong></td>
                                            <td>{{ loanSelection.requestedAmount |
                                                currency:loanSelection.currencyCode:true: '1.2-2'}}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><strong>Unapproved Request</strong></td>
                                            <td>{{ loanSelection.pendingRequestAmount |
                                                currency:loanSelection.currencyCode:true: '1.2-2'}}
                                            </td>
                                            <td><strong>Approved Request</strong></td>
                                            <td>{{ loanSelection.approveRequestAmount |
                                                currency:loanSelection.currencyCode:true: '1.2-2'}}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><strong>Total Request</strong></td>
                                            <td>{{ loanSelection.allRequestAmount |
                                                currency:loanSelection.currencyCode:true: '1.2-2'}}
                                            </td>
                                            <td><strong>Available Balance</strong></td>
                                            <td>{{ loanSelection.approvedAmount - loanSelection.allRequestAmount |
                                                currency:loanSelection.currencyCode:true: '1.2-2'}}
                                            </td>
                                        </tr>

                                    </tbody>
                                </table>
                            </div>
                        </p-tabPanel>
                        <p-tabPanel header="Appraisal Memorandum">
                            <div *ngIf="isMultipleDrawdown" class="panel-body">
                                <p-dataTable [paginator]="false" resizableColumns="true" [responsive]="true"
                                    [value]="drawdownFacilitiesInformation" selectionMode="single"
                                    (onRowSelect)="pushSelectedLoans($event)"
                                    (onRowUnselect)="popSelectedLoans($event)">
                                    <p-header>Multiple Facility Drawdown</p-header>
                                    <!-- <p-column [style]="{'width':'38px'}" selectionMode="multiple"></p-column> -->
                                    <p-column [style]="{'width':'150px'}" field="productTypeName" header="Facility Type"
                                        sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                    <p-column [style]="{'width':'150px'}" field="productName" header="Facility Name"
                                        sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                    <p-column field="applicationReferenceNumber" header="Ref No" sortable="true"
                                        [filter]="true" filterMatchMode="contains"></p-column>
                                    <p-column [style]="{'width':'150px'}" field="customerName" header="Obligor Name"
                                        sortable="true" [filter]="true" filterMatchMode="contains">
                                        <ng-template pTemplate="body" let-item="rowData">
                                            <span *ngIf="item.loanTypeId == 3">{{item.applicantName}}</span>
                                            <span *ngIf="item.loanTypeId != 3">{{item.customerName}}</span>
                                        </ng-template>
                                    </p-column>
                                    <p-column [style]="{'text-align':'right','width':'115px'}" field="approvedAmount"
                                        header="Approved Amount" sortable="true" [filter]="true"
                                        filterMatchMode="contains">
                                        <ng-template pTemplate="body" let-item="rowData">
                                            {{item.approvedAmount | currency:item.currencyCode:true: '1.2-2'}}
                                        </ng-template>
                                    </p-column>
                                    <p-column [style]="{'text-align':'right','width':'115px'}" field="amountDisbursed"
                                        header="Disbursed Amount" sortable="true" [filter]="true"
                                        filterMatchMode="contains">
                                        <ng-template pTemplate="body" let-item="rowData">
                                            {{item.amountDisbursed | currency:item.currencyCode:true: '1.2-2'}}
                                        </ng-template>
                                    </p-column>
                                    <p-column [style]="{'text-align':'right','width':'115px'}" field="allRequestAmount"
                                        header="Requested Amount" sortable="true" [filter]="true"
                                        filterMatchMode="contains">
                                        <ng-template pTemplate="body" let-item="rowData">
                                            {{item.allRequestAmount | currency:item.currencyCode:true: '1.2-2'}}
                                        </ng-template>
                                    </p-column>
                                    <p-column [style]="{'width':'50px'}" field="interestRate" header="Interest"
                                        [filter]="true" filterMatchMode="contains"></p-column>
                                    <p-column [style]="{'width':'80px'}" field="approvedTenor" header="Tenor"
                                        sortable="true" [filter]="true" filterMatchMode="contains">
                                        <ng-template pTemplate="body" let-item="rowData">
                                            {{item.approvedTenorString}}
                                        </ng-template>
                                    </p-column>
                                </p-dataTable>
                            </div>
                            <!-- [disabled]="disableAppraisalMemorandumTab || applicationSelection.productClassProcessId == 2"> -->

                            <!-- cam document -->
                            <div class="card no-padding">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <div class="row">
                                            <div class="col-md-9">
                                            </div>
                                            <div class="col-md-3">
                                                <div class="pull-right">

                                                    <button (click)="previewDocumentation(true)"
                                                        style="padding: 3px 6px 3px 6px;">
                                                        <span class="glyphicon glyphicon-print"></span> Print</button>
                                                </div>
                                            </div>
                                        </div>
                                        <h2 *ngIf="documentations.length > 0" class="panel-title">
                                            FACILITY APPROVAL MEMO No.:
                                            <strong>{{ loanSelection?.applicationReferenceNumber }}</strong>
                                            <!-- of OBLIGOR:
                                            <strong>{{ loanSelection?.customerName }}</strong> -->
                                        </h2>
                                    </div>


                                    <div class="panel panel-default">

                                        <div class="panel-body" style="overflow:auto;height:400px">
                                            <div *ngFor="let x of documentations">
                                                <!-- <p><strong>{{x.title}}</strong></p> -->
                                                <p><span [innerHtml]="x.templateDocument"></span></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </p-tabPanel>
                        <p-tabPanel header="Offer Letter">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <h2 class="panel-title pull-left">
                                                Generated Offer Letter
                                            </h2>
                                            <!-- <button type="button" (click)="displayReport=false" style="margin-right:5px" class="btn btn-danger pull-right">Cancel</button> -->
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-body">
                                    <iframe [src]="reportSrc" id="report" name="report" frameborder="2" height="500px"
                                        width="750px" style="overflow:auto"></iframe>
                                    <!-- <div class="col-md-12"  style=" width:1000px; overflow:auto;">

                                    </div> -->
                                </div>
                            </div>
                        </p-tabPanel>
                        <p-tabPanel header="Supporting Documents" *ngIf="loanSelection">
                            <!-- <document-upload 
                                [deleteLink]="false"
                                [panelTitle]="CREDITAPPRIASALDOC"
                                [reload]="reload" 
                                [operationId]="loanSelection?.operationId" 
                                [isOperationSpecific]="false"
                                [targetId]="loanSelection?.loanApplicationId" 
                                [targetReferenceNumber]="loanSelection?.applicationReferenceNumber">
                            </document-upload>  -->
                            <document-upload [operationId]="loanSelection?.appraisalOperationId"
                                [customerId]="loanSelection?.customerId" [reload]="reload" [reloadDocsOnly]="reloadDocs"
                                [targetId]="loanSelection?.loanApplicationId" [isOperationSpecific]="false"
                                [targetReferenceNumber]="loanSelection?.applicationReferenceNumber"
                                (uploadCount)="setNumberOfUploads($event)" [isFromDrawDownRequest]="true">
                            </document-upload>
                            <!-- <div class="panel panel-default">
                                        <div class="panel-heading">
                                            <h2 class="panel-title">
                                                Supporting Documents
                                            </h2>
                                        </div>
                                        <div *ngIf="isMultipleDrawdown"  class="panel-body">
                                                <p-dataTable [paginator]="false" resizableColumns="true" [responsive]="true" [value]="drawdownFacilitiesInformation" selectionMode="single" (onRowSelect)="pushSelectedLoans($event)" (onRowUnselect)="popSelectedLoans($event)">
                                                        <p-header>Multiple Facility Drawdown</p-header>
                                                        <p-column [style]="{'width':'38px'}" selectionMode="multiple"></p-column>
                                                        <p-column [style]="{'width':'150px'}" field="productTypeName" header="Facility Type" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                                        <p-column [style]="{'width':'150px'}" field="productName" header="Facility Name" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                                        <p-column field="applicationReferenceNumber" header="Ref No" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                                        <p-column [style]="{'width':'150px'}" field="customerName" header="Obligor Name" sortable="true" [filter]="true" filterMatchMode="contains">
                                                            <ng-template  pTemplate="body" let-item="rowData" >
                                                                <span *ngIf="item.loanTypeId == 3">{{item.applicantName}}</span>
                                                                <span *ngIf="item.loanTypeId != 3">{{item.customerName}}</span>
                                                            </ng-template>
                                                        </p-column>
                                                        <p-column [style]="{'text-align':'right','width':'115px'}" field="approvedAmount" header="Approved Amount" sortable="true" [filter]="true" filterMatchMode="contains">
                                                            <ng-template pTemplate="body" let-item="rowData">
                                                                {{item.approvedAmount | currency:item.currencyCode:true: '1.2-2'}}
                                                            </ng-template>
                                                        </p-column>
                                                        <p-column [style]="{'text-align':'right','width':'115px'}" field="amountDisbursed" header="Disbursed Amount" sortable="true" [filter]="true" filterMatchMode="contains">
                                                            <ng-template pTemplate="body" let-item="rowData">
                                                                {{item.amountDisbursed | currency:item.currencyCode:true: '1.2-2'}}
                                                            </ng-template>
                                                        </p-column>
                                                        <p-column [style]="{'text-align':'right','width':'115px'}" field="allRequestAmount" header="Requested Amount" sortable="true" [filter]="true" filterMatchMode="contains">
                                                            <ng-template pTemplate="body" let-item="rowData">
                                                                {{item.allRequestAmount | currency:item.currencyCode:true: '1.2-2'}}
                                                            </ng-template>
                                                        </p-column>
                                                        <p-column [style]="{'width':'50px'}" field="interestRate" header="Interest" [filter]="true" filterMatchMode="contains"></p-column>
                                                        <p-column [style]="{'width':'80px'}" field="approvedTenor" header="Tenor" sortable="true" [filter]="true" filterMatchMode="contains">
                                                            <ng-template pTemplate="body" let-item="rowData">
                                                                {{item.approvedTenorString}}
                                                            </ng-template>
                                                        </p-column>
                                                    </p-dataTable>
                                        </div>
                                        <div class="panel-body">
                                            <p-dataTable [value]="supportingDocuments" [paginator]="true" [rows]="5">
                                                <p-column field="documentTitle" header="Document Title" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                                <p-column field="fileExtension" header="Type" [filter]="true" filterMatchMode="contains" [style]="{'width':'60px'}"></p-column>
                                                <p-column field="physicalFileNumber" header="File Number" sortable="true" [filter]="true" filterMatchMode="contains" [style]="{'width':'150px'}"></p-column>
                                                <p-column field="physicalLocation" header="Physical Location" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                                <p-column [style]="{'width':'100px'}">
                                                    <ng-template pTemplate="header"> </ng-template>
                                                    <ng-template pTemplate="body" let-d="rowData" let-i="rowIndex">
                                                        <a *ngIf="['jpg','jpeg', 'png'].indexOf(d.fileExtension.toLowerCase()) > -1" (click)="viewDocument(d.documentId)" href="javascript:void(0)">View</a>
                                                        <a *ngIf="['doc','docx', 'pdf','xls', 'xlsx'].indexOf(d.fileExtension.toLowerCase()) > -1" (click)="DownloadDocument(d.documentId)" href="javascript:void(0)">Download</a>
                                                    </ng-template>
                                                </p-column>
                                            </p-dataTable>

                                        </div>
                                </div> -->
                        </p-tabPanel>

                        <p-tabPanel header="Other Information">
                            <p-accordion #accordion>
                                <p-accordionTab header="Customer Information">
                                    <button *ngIf="displayShowCustInfo" type="button" class="btn btn-primary"
                                        (click)="showCustomerInformation()" style="margin-right:5px">
                                        <i class="glyphicon glyphicon-info"></i> Show Customer Information</button>
                                    <app-customer-information-detail [loanApplicationId]="loanApplId">
                                    </app-customer-information-detail>
                                </p-accordionTab>
                                <p-accordionTab header="Facility Collateral(s)">
                                    <div style="padding: 15px 0px 15px 0px">
                                        <collateral-information [applicationId]="loanSelection?.loanApplicationId"
                                            [customerGroupId]="loanSelection?.customerGroupId"
                                            [loanTypeId]="loanSelection?.loanTypeId"
                                            [isRegistrationDoneViaLoanApplication]="isRegistrationDoneViaLoanApplication"
                                            [applicationCustomerId]="loanSelection?.customerId"
                                            [showCustomerCollaterals]="true"
                                            [applicationCustomerName]="loanSelection?.customerName"
                                            [currencyId]="loanSelection?.currencyId" [reloadCustomerCollateral]="reload"
                                            [autoMapNew]="true" [hideProposeButton]="false"
                                            [collateralAtAppraisal]="true" (proceedEvent)="refreshCollateral()"
                                            [hideCreateButton]="false" [canEditExternally]="false"
                                            [loanApplicationDetailId]="loanApplicationDetailId">
                                        </collateral-information>
                                    </div>

                                </p-accordionTab>
                                <p-accordionTab header="Loan Job Requests">
                                    <div *ngIf="loanSelection != null && loanSelection != undefined" class="panel-body"
                                        style="overflow:auto;height:250px">
                                        <job-request-view [loanApplicationId]=loanApplId
                                            [loanApplicationDetailId]=loanApplDetailId
                                            [operationId]=loanSelection.operationId [showTitle]=false>
                                        </job-request-view>
                                    </div>
                                </p-accordionTab>
                            </p-accordion>
                        </p-tabPanel>

                        <!-- <p-tabPanel header="Drawdown Memo">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <h2 class="panel-title pull-left">
                                                Drawdown Memo
                                            </h2>
                                                <button  (click)="printDrawdownMemo()" style="margin-left:25px" >Generate Drawdown Memo</button>
                                        </div>
                                    </div>
                                </div>
                                <div id='print-drawdon-section' class="panel-body" [innerHtml]="drawdownHtml"></div>
                            </div>

                        </p-tabPanel> -->

                        <p-tabPanel header="Lien Placement">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <h2 class="panel-title pull-left">
                                                Cash Collateral Lien Placement
                                            </h2>
                                            <!-- <button type="button" (click)="displayReport=false" style="margin-right:5px" class="btn btn-danger pull-right">Cancel</button> -->
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-body">
                                    <app-lien-on-investment *ngIf="loanSelection"
                                        [loanApplicationId]="loanSelection.loanApplicationId"
                                        [applicationDetailId]="loanSelection.loanApplicationDetailId"
                                        [currencyId]="loanSelection.currencyId"
                                        [reload]="loanSelection.loanApplicationId" [isUserLegal]="isUserLegal"
                                        (allLiensArePlaced)=lienIsSatisfied($event)>
                                    </app-lien-on-investment>
                                </div>
                            </div>
                        </p-tabPanel>
                        <p-tabPanel header="Approval Comments">
                            <div class="panel panel-default" *ngIf="loanSelection">
                                <app-approval-comments [all]="true" [tableLabel]="'Approval Process Comments'"
                                    [operationId]="loanSelection?.appraisalOperationId"
                                    [applicationId]="loanSelection?.loanApplicationId"></app-approval-comments>

                                <!-- <app-approval-comments [operationId]="loanSelection.appraisalOperationId"
                                    [applicationId]="loanSelection.loanApplicationId" [tableLabel]="commentTitle">
                                </app-approval-comments>
                                <app-approval-comments [operationId]="loanSelection.operationId"
                                    [applicationId]="loanSelection.loanBookingRequestId" [tableLabel]="commentTitle2">
                                </app-approval-comments> -->
                            </div>
                        </p-tabPanel>

                        <!-- Obligor UUS Checklist Tab -->
                        <p-tabPanel i18n-header header="Obligor UUS Checklist">
                            <!-- Checklist Summary Dashboard for Selected Individual Loan -->
                            <div *ngIf="loanSelection"
                                style="margin: 20px; padding: 20px; background-color: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                <h2 class="panel-title" style="margin-top: 0; margin-bottom: 15px; text-align: center;">
                                    Checklist Summary Dashboard - {{ loanSelection.customerName }}
                                    ({{ loanSelection.applicationReferenceNumber }})
                                </h2>

                                <div *ngIf="isLoadingChecklistSummary" style="text-align: center; padding: 20px;">
                                    <span>Loading checklist summary...</span>
                                </div>

                                <div *ngIf="!isLoadingChecklistSummary && checklistSummary.total > 0"
                                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">

                                    <!-- Yes Percentage Card -->
                                    <div
                                        style="background-color: #28a745; color: white; padding: 15px; border-radius: 6px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <div style="font-size: 28px; font-weight: bold; margin-bottom: 5px;">
                                            {{ checklistSummary.yesPercent }}%
                                        </div>
                                        <div style="font-size: 16px; opacity: 0.9; margin-bottom: 5px;">Met</div>
                                        <div style="font-size: 12px; opacity: 0.8;">
                                            ({{ checklistSummary.yes }} of {{ checklistSummary.total }})
                                        </div>
                                    </div>

                                    <!-- No Percentage Card -->
                                    <div
                                        style="background-color: #dc3545; color: white; padding: 15px; border-radius: 6px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <div style="font-size: 28px; font-weight: bold; margin-bottom: 5px;">
                                            {{ checklistSummary.noPercent }}%
                                        </div>
                                        <div style="font-size: 16px; opacity: 0.9; margin-bottom: 5px;">Not Met</div>
                                        <div style="font-size: 12px; opacity: 0.8;">
                                            ({{ checklistSummary.no }} of {{ checklistSummary.total }})
                                        </div>
                                    </div>

                                    <!-- Waived Percentage Card -->
                                    <div
                                        style="background-color: #ffc107; color: #212529; padding: 15px; border-radius: 6px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <div style="font-size: 28px; font-weight: bold; margin-bottom: 5px;">
                                            {{ checklistSummary.waivedPercent }}%
                                        </div>
                                        <div style="font-size: 16px; opacity: 0.9; margin-bottom: 5px;">Waived</div>
                                        <div style="font-size: 12px; opacity: 0.8;">
                                            ({{ checklistSummary.waived }} of {{ checklistSummary.total }})
                                        </div>
                                    </div>

                                    <!-- Deferred Percentage Card -->
                                    <div
                                        style="background-color: #17a2b8; color: white; padding: 15px; border-radius: 6px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <div style="font-size: 28px; font-weight: bold; margin-bottom: 5px;">
                                            {{ checklistSummary.deferredPercent }}%
                                        </div>
                                        <div style="font-size: 16px; opacity: 0.9; margin-bottom: 5px;">Deferred</div>
                                        <div style="font-size: 12px; opacity: 0.8;">
                                            ({{ checklistSummary.deferred }} of {{ checklistSummary.total }})
                                        </div>
                                    </div>
                                </div>

                                <div *ngIf="!isLoadingChecklistSummary && checklistSummary.total === 0"
                                    style="text-align: center; padding: 20px; color: #6c757d;">
                                    No checklist items found for this loan.
                                </div>
                            </div>
                            <!-- End Checklist Summary Dashboard -->

                            <div class="panel panel-default" *ngIf="loanSelection">
                                <div class="panel-heading">
                                    <h2 class="panel-title">Obligor UUS Checklist Review</h2>
                                </div>
                                <div class="panel-body">
                                    <p-dataTable [value]="uwsList" [responsive]="true" [paginator]="true" [rows]="5"
                                        [rowsPerPageOptions]="[5,10,20,30]" [totalRecords]="uwsList?.length || 0">

                                        <p-column i18n-header field="item" header="Item" [style]="{'width':'15%'}">
                                            <ng-template let-uws="rowData" pTemplate="body">
                                                {{ uws.item }}
                                            </ng-template>
                                        </p-column>

                                        <p-column i18n-header field="description" header="Description">
                                            <ng-template let-uws="rowData" pTemplate="body">
                                                {{ uws.description }}
                                            </ng-template>
                                        </p-column>

                                        <p-column i18n-header header="Option"
                                            [style]="{'width':'20%','text-align':'center'}">
                                            <ng-template let-uws="rowData" pTemplate="body">
                                                <div [ngStyle]="getRowStyle(uws)"
                                                    style="display: flex; flex-direction: column; align-items: flex-start; gap: 5px; padding: 8px;">
                                                    <label style="display: flex; align-items: center; gap: 5px;">
                                                        <input type="radio" [(ngModel)]="uws.option"
                                                            [ngModelOptions]="{ standalone: true }" value="Yes"
                                                            [name]="'option' + uws.id" disabled> Met
                                                    </label>
                                                    <label style="display: flex; align-items: center; gap: 5px;">
                                                        <input type="radio" [(ngModel)]="uws.option"
                                                            [ngModelOptions]="{ standalone: true }" value="No"
                                                            [name]="'option' + uws.id" disabled> Not Met
                                                    </label>
                                                    <label style="display: flex; align-items: center; gap: 5px;">
                                                        <input type="radio" [(ngModel)]="uws.option"
                                                            [ngModelOptions]="{ standalone: true }" value="Waiver"
                                                            [name]="'option' + uws.id" disabled> Waiver
                                                    </label>
                                                    <label style="display: flex; align-items: center; gap: 5px;">
                                                        <input type="radio" [(ngModel)]="uws.option"
                                                            [ngModelOptions]="{ standalone: true }" value="Deferred"
                                                            [name]="'option' + uws.id" disabled> Deferred
                                                    </label>
                                                </div>
                                            </ng-template>
                                        </p-column>

                                        <p-column i18n-header header="Defer Date"
                                            [style]="{'width':'15%','text-align':'center'}">
                                            <ng-template let-uws="rowData" pTemplate="body">
                                                <ng-container *ngIf="uws.option === 'Deferred'; else showNA">
                                                    <input type="date" [(ngModel)]="uws.deferredDate"
                                                        [ngModelOptions]="{ standalone: true }"
                                                        [name]="'deferredDate' + uws.id" class="form-control" readonly
                                                        disabled
                                                        style="border: 1px solid #ccc; padding: 8px 12px; border-radius: 5px; width: 100%;">
                                                </ng-container>
                                                <ng-template #showNA>N/A</ng-template>
                                            </ng-template>
                                        </p-column>

                                        <p-column i18n-header header="View Document"
                                            [style]="{'width':'15%','text-align':'center'}">
                                            <ng-template let-uws="rowData" pTemplate="body">
                                                <div
                                                    style="display: flex; justify-content: center; align-items: center;">
                                                    <button *ngIf="uws.option !== 'Deferred'" type="button"
                                                        class="ui-button ui-button-primary"
                                                        (click)="viewDocuments(uws)">
                                                        Preview
                                                    </button>
                                                </div>
                                            </ng-template>
                                        </p-column>
                                    </p-dataTable>
                                </div>
                            </div>
                        </p-tabPanel>
                        <!-- END -->

                        <!-- Document Preview Modal -->
                        <p-dialog [(visible)]="isPreviewModalVisible" [modal]="true" [style]="getModalStyle()"
                            [closable]="true" (onHide)="closePreviewModal()" [draggable]="false">
                            <div
                                style="display: flex; justify-content: center; align-items: center; padding: 10px; position: relative;">
                                <h3 style="margin: 0; flex: 1; text-align: center;">
                                    Document Preview for {{ loanSelection?.customerName }}
                                </h3>
                                <div style="cursor: pointer; width: 30px; height: 30px; display: flex; align-items: center;
                                        justify-content: center; border: 2px solid red; border-radius: 5px; background-color: white;
                                        position: absolute; right: 10px;" (click)="closePreviewModal()">
                                    <span style="font-size: 20px; color: red; font-weight: bold;"></span>
                                </div>
                            </div>
                            <hr style="margin: 0 10px; border-top: 1px solid gray;">
                            <div style="padding: 15px; width: 100%; text-align: center;">
                                <div *ngIf="fileType?.includes('image')"
                                    style="display: flex; align-items: center; justify-content: center; overflow: hidden;">
                                    <img [src]="selectedDocumentUrl" [style.transform]="'scale(' + zoomLevel + ')'"
                                        style="max-height: 500px; object-fit: contain; transition: transform 0.3s ease-in-out; cursor: grab;"
                                        (wheel)="onScrollZoom($event)" (mousedown)="startDrag($event)"
                                        (click)="toggleZoom()" />
                                </div>
                                <div *ngIf="fileType === 'application/pdf'"
                                    style="overflow: hidden; position: relative;">
                                    <iframe #pdfFrame [src]="selectedDocumentUrl" width="100%" height="550px"
                                        (wheel)="onScrollZoom($event)"
                                        style="cursor: grab; transform-origin: center;"></iframe>
                                </div>
                                <div *ngIf="fileType === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
                                        || fileType === 'application/msword'"
                                    style="overflow: hidden; position: relative;">
                                    <iframe #docFrame [src]="selectedDocumentUrl" width="100%" height="550px"
                                        (wheel)="onScrollZoom($event)"
                                        style="cursor: grab; transform-origin: center;"></iframe>
                                </div>
                                <div *ngIf="!fileType?.includes('image') && fileType !== 'application/pdf'
                                        && fileType !== 'application/msword'
                                        && fileType !== 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'"
                                    style="color: red; font-weight: bold;">
                                    Unsupported file type.
                                </div>
                            </div>
                        </p-dialog>
                        <!-- END -->

                        <p-tabPanel
                            *ngIf="loanSelection?.appraisalOperationId == 202 || loanSelection?.appraisalOperationId == 146"
                            header="Approval Memo">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <h2 class="panel-title pull-left">
                                                Approval Memo
                                            </h2>
                                            <button *ngIf="userIsAccountOfficer" type="button" (click)="editCashBack()"
                                                [disabled]="!initiationForm.invalid"
                                                class="btn btn-success pull-right">Edit Memo</button>
                                        </div>
                                    </div>
                                </div>
                                <div *ngIf="cashBackHtml != null" class="panel-body" style="min-height:450px;">
                                    <app-ckeditior-project [content]="cashBackHtml" [height]="400"
                                        (contentChange)="contentChange($event)"></app-ckeditior-project>
                                </div>

                            </div>

                        </p-tabPanel>
                        <p-tabPanel header="Project Risk Rating"
                            *ngIf="(loanSelection != null && projectRiskRatingss.length > 0)">
                            <div class="panel panel-default">

                                <div class="panel-heading">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <h2 class="panel-title pull-left">
                                                Project Risk Rating
                                            </h2>
                                            <div class="pull-right">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="panel-body">

                                    <table class="table table-bordered table-hover">

                                        <tr>
                                            <th>SN</th>
                                            <th>Criteria</th>
                                            <th>Value</th>
                                        </tr>
                                        <tbody>

                                            <tr *ngFor="let field of projectRiskRatingComputation; let i = index;">
                                                <td>{{i + 1}}</td>
                                                <td>{{field.categoryName}}</td>
                                                <td>{{field.categoryValue}}</td>
                                            </tr>
                                            <tr>
                                                <td colspan="2"><strong>OBLIGOR/ CONTRACTOR
                                                    </strong></td>
                                                <td><strong>{{rating}}</strong></td>
                                            </tr>
                                            <tr>
                                                <td colspan="2"><strong>Rating
                                                    </strong></td>
                                                <td><strong>{{computation}}</strong></td>
                                            </tr>
                                            <tr>
                                                <td colspan="2"><strong>Risk Categorisation
                                                    </strong></td>
                                                <td><strong>{{riskCategorisation}}</strong></td>
                                            </tr>
                                            <tr>
                                                <td colspan="2"><strong>Project Location
                                                    </strong></td>
                                                <td><strong>{{projectLocation}}</strong></td>
                                            </tr>
                                            <tr>
                                                <td colspan="2"><strong>Project Details
                                                    </strong></td>
                                                <td><strong>{{projectDetails}}</strong></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div class="panel-footer">
                                        <div class="row">
                                            <div class="col-md-12">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </p-tabPanel>

                    </p-tabView>
                </form>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-md-12">
                            <button type="button" style="margin-left:5px" (click)="offerLetterChecklist()"
                                class="btn btn-success pull-left">
                                <i class="glyphicon glyphicon-ok"></i> Deferral Waivers</button>
                            <!-- <button type="button" (click)="initiateBooking(initiationForm)" [disabled]="!initiationForm.invalid" class="btn btn-success pull-right">Initiate Booking</button> -->
                            <button type="button" (click)="closeDialog()" style="margin-right:5px"
                                class="btn btn-danger pull-right">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

            <p-dialog [responsive]=true [(visible)]="showCasgBackForm" id="add-modal" modal="modal" showEffect="fade"
                width="1200">
                <div style="margin-bottom:0" class="panel panel-default">
                    <div class="panel-heading">
                        <h2 class="panel-title">
                            CASHBACK
                        </h2>
                    </div>

                    <form novalidate [formGroup]="cashBackForm" autocomplete="off">
                        <div class="panel-body">
                            <div class="form-horizontal">
                                <div class="form-group">
                                    <label for="" class="control-label col-md-2">Background</label>
                                    <div class="col-md-4 pull-left">
                                        <input type="text" formControlName="background"
                                            [ngClass]="!cashBackForm.controls['background'].valid ? 'required-input' : 'valid-input'"
                                            name="background" class="form-control">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="" class="control-label col-md-2">Issues</label>
                                    <div class="col-md-4 pull-left">
                                        <input type="text" formControlName="issues"
                                            [ngClass]="!cashBackForm.controls['issues'].valid ? 'required-input' : 'valid-input'"
                                            name="issues" class="form-control">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="" class="control-label col-md-2">Request</label>
                                    <div class="col-md-4 pull-left">
                                        <input type="text" formControlName="request"
                                            [ngClass]="!cashBackForm.controls['request'].valid ? 'required-input' : 'valid-input'"
                                            name="request" class="form-control">
                                    </div>
                                </div>

                            </div>
                        </div>

                        <div class="panel-footer">
                            <div class="row">
                                <div class="col-md-12">
                                    <button type="button" (click)="submitCashbackForm(cashBackForm)"
                                        [disabled]="cashBackForm.invalid"
                                        class="btn btn-success pull-right">Save</button>
                                    <button type="button" (click)="showCasgBackForm=false" style="margin-right:5px"
                                        class="btn btn-danger pull-right">Cancel</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </p-dialog>

            <div *ngIf="displayInitiationForm && loanSelection != null && loanSelection != 'undefined'">
                <risk-acceptance-criteria [racCategoryTypeId]="racCategoryTypeId" [isDrawdown]="true"
                    [racSearchBaseId]="racSearchBaseId" [racOperationId]="loanSelection?.operationId"
                    [customerId]="loanSelection?.customerId" [racCurrencyId]="racCurrencyId"
                    [loanApplicationId]="loanSelection?.loanApplicationId" [operationId]="loanSelection?.operationId"
                    [racProductClassId]="racProductClassId" [searchBasePlaceholder]="searchBasePlaceholder"
                    [productId]="loanSelection?.productId" [reload]="loanSelection?.productId"
                    [getFormOutput]="submitEvent" (formOutput)="setRacValues($event)">
                </risk-acceptance-criteria>
            </div>
        </div>

        <div class="panel-footer">
            <div class="row">
                <div class="col-md-12">
                </div>
            </div>
        </div>

        <!--end of card1-->
    </div>
</div>

<fintrakbanking-message [title]="title" [message]="message" [show]="show" [cssClass]="cssClass"
    (closeEvent)="hideMessage($event)">
</fintrakbanking-message>

<!--modal for obligor / Loan details starts-->

<p-dialog [responsive]=true [(visible)]="displayDocument" modal="modal" showEffect="fade" width="1200">
    <div *ngIf="displayDocument" style="margin-bottom:0" class="panel panel-default">

        <div class="panel-heading">
            <h2 class="panel-title">
                Document Title: <strong>{{ selectedDocument }}</strong>
            </h2>
            <div class="pull-right"><a class="close" (click)="displayDocument=false">&times;</a></div>
        </div>

        <div class="panel-body" style="overflow:auto;height:450px">

            <img *ngIf="binaryFile" style="max-width: 100%; display: block 2px black;"
                [src]="'data:image/jpg;base64,'+binaryFile" alt="" class="img-thumbnail">
        </div>
    </div>
</p-dialog>



<!-- <app-condition-checklist [isLMSChecklist]="false" [showOrHideList]='false'></app-condition-checklist> -->
<!-- <p-dialog [responsive]=true [(visible)]="showCollateralInformation" id="charge-modal" modal="modal" width="1000"> -->
<!-- <collateral-information-view [reload]="reload" [jobReply]="false"
    [showCollateralInformation]="showCollateralInformation" (closeWindow)="closeCollateralDetaits($event)"
    [collateralCustomerId]="collateralCustomerId">
</collateral-information-view> -->
<!-- </p-dialog> -->

<app-condition-checklist *ngIf="loanSelection != null" [isLMSChecklist]="false" [showOrHideList]="false"
    [operationId]="loanSelection.operationId" [customerId]="loanSelection.customerId"
    [loanReviewApplicationId]="offerLetterChecklistIndex"
    (resetofferLetterChecklist)="resetofferLetterChecklist($event)" (refreshProvidedDocuments)="refreshDoc($event)"
    [applicationRefNumber]="loanSelection.applicationReferenceNumber"
    [loanApplicationId]="loanSelection.loanApplicationId">
</app-condition-checklist>

<!-- <p-dialog [responsive]=true [(visible)]="showCollateralInformation" id="charge-modal" modal="modal" width="1000"> 
<collateral-information-view [reload]="reload" [jobReply]="false"
    [showCollateralInformation]="showCollateralInformation" (closeWindow)="closeCollateralDetaits($event)"
    [collateralCustomerId]="collateralCustomerId">
</collateral-information-view> 
</p-dialog> -->



<p-dialog [responsive]=true [(visible)]="displayReport" width="1200" modal="modal" showEffect="fade">
    <div class="panel panel-default">
        <div class="panel-heading">
            <div class="row">
                <div class="col-md-12">
                    <h2 class="panel-title pull-left">
                        Drawdown Memo

                    </h2>
                    <button type="button" (click)="displayReport=false" style="margin-right:5px"
                        class="btn btn-danger pull-right">Cancel</button>


                </div>
            </div>
        </div>
        <div class="panel-body">

            <div class="col-md-12" *ngIf="displayTestReport" style=" width:1200px; overflow:auto;">
                <iframe [src]="reportSrc" id="report" name="report" frameborder="2" height="500px" width="1200px"
                    style="overflow:auto"></iframe>
            </div>
        </div>
    </div>
    <div class="panel-footer">
        <div class="row">
            <div class="col-md-12">
                <button type="button" (click)="displayReport=false" style="margin-right:5px"
                    class="btn btn-danger pull-right">Cancel</button>
            </div>
        </div>
    </div>
</p-dialog>

<p-dialog [responsive]=true [(visible)]="displayMemberSearchForm" modal="modal" id="searchModal" showEffect="fade"
    width="650" [contentStyle]="{'overflow':'auto','max-height':'700px'}">
    <div style="margin-bottom:0" class="panel panel-default">
        <div class="panel-heading">
            <div style="margin-left:0" class="row">
                <h2 class="panel-title pull-left">
                    Search Member
                </h2>
                <div class="pull-right">
                    <a class="close" style="margin: -10px 8px;" (click)="displayMemberSearchForm=false">&times;</a>
                </div>
            </div>
        </div>
        <div style="padding:3px" class="panel-body">
            <div class="form-group">
                <div class="col-md-12">
                    <input type="text" id="search" #approvalInPut (keyup)="searchApprover($event.target.value)"
                        class="form-control" placeholder="Type in the member name...">
                </div>
            </div>

            <div class="form-group">
                <div class="col-md-12">
                    <p>
                        <!--{{mfacilityType}}-->
                    </p>
                    <table *ngIf="groupMembers" class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Customer Code</th>
                                <th>First Name</th>
                                <th>Middle Name</th>
                                <th>Last Name</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr (click)="pickSearchedApprover(res)" style="cursor: pointer"
                                *ngFor="let res of groupMembers; let i = index">
                                <td>{{res.customerCode}}</td>
                                <td>{{res.firstName}}</td>
                                <td>{{res.secondName}}</td>
                                <td>{{res.lastName}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</p-dialog>

<p-dialog [responsive]=true [(visible)]="displayApproverSearchForm" modal="modal" id="searchModal" showEffect="fade"
    width="650" [contentStyle]="{'overflow':'auto','max-height':'700px'}">
    <div style="margin-bottom:0" class="panel panel-default">
        <div class="panel-heading">
            <div style="margin-left:0" class="row">
                <h2 class="panel-title pull-left">
                    Search Staff
                </h2>
                <div class="pull-right">
                    <a class="close" style="margin: -10px 8px;" (click)="displayApproverSearchForm=false">&times;</a>
                </div>
            </div>
        </div>
        <div style="padding:3px" class="panel-body">
            <div class="form-group">
                <div class="col-md-12">
                    <input type="text" id="staffSearch" #staffInPut (keyup)="searchApprover($event.target.value)"
                        class="form-control" placeholder="Type in the staff name...">
                </div>
            </div>

            <div class="form-group">
                <div class="col-md-12">
                    <p>
                        <!--{{mfacilityType}}-->
                    </p>
                    <table *ngIf="availableApprovers" class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Staff Code</th>
                                <th>First Name</th>
                                <th>Middle Name</th>
                                <th>Last Name</th>
                                <th>Staff Role</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr (click)="pickSearchedApprover(res)" style="cursor: pointer"
                                *ngFor="let res of availableApprovers; let i = index">
                                <td>{{res.staffCode}}</td>
                                <td>{{res.firstName}}</td>
                                <td>{{res.secondName}}</td>
                                <td>{{res.lastName}}</td>
                                <td>{{res.staffRoleName}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</p-dialog>

<p-dialog [responsive]=true [(visible)]="displayCustomerSearchForm" modal="modal" id="searchModal" showEffect="fade"
    width="650" [contentStyle]="{'overflow':'auto','max-height':'700px'}">
    <div style="margin-bottom:0" class="panel panel-default">
        <div class="panel-heading">
            <div style="margin-left:0" class="row">
                <h2 class="panel-title pull-left">
                    Search Customer
                </h2>
                <div class="pull-right">
                    <a class="close" style="margin: -10px 8px;" (click)="displayCustomerSearchForm=false">&times;</a>
                </div>
            </div>
        </div>
        <div style="padding:3px" class="panel-body">
            <div class="form-group">
                <div class="col-md-12">
                    <input type="text" id="search" #customerInPut (keyup)="searchApprover($event.target.value)"
                        class="form-control" placeholder="Type in the customer name...">
                </div>
            </div>

            <div class="form-group">
                <div class="col-md-12">
                    <p>
                        <!--{{mfacilityType}}-->
                    </p>
                    <table *ngIf="customers" class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Customer Code</th>
                                <th>Customer Name</th>
                                <th>Customer Type</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr (click)="pickSearchedApprover(res)" style="cursor: pointer"
                                *ngFor="let res of customers; let i = index">
                                <td>{{res.customerCode}}</td>
                                <td>{{res.customerName}}</td>
                                <td>{{res.customerTypeName}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</p-dialog>

<!-- =================================== contracror criteria ======================== -->
<p-dialog [responsive]="true" [(visible)]="displayProjectRiskRatingModal" id="limit-def-modal" modal="modal"
    showEffect="fade" width="1000">

    <div class="panel panel-default"
        *ngIf="projectRiskRatings != null && projectRiskRatings != undefined && projectRiskRatings != {}">

        <div *ngIf="projectRiskRatings != null" class="panel-heading">
            <div class="row">
                <div class="col-md-12">
                    <h2 class="panel-title pull-left">
                        Project Risk Rating
                    </h2>
                    <div class="pull-right">
                    </div>
                </div>
            </div>
        </div>

        <div class="panel-body">

            <form *ngIf="projectRiskRatings != null && projectRiskRatings != undefined && projectRiskRatings != {}"
                [formGroup]="projectRiskRatingForm" class="form-horizontal" autocomplete="off">
                <table class="table table-bordered table-hover">

                    <tr>
                        <th>SN</th>
                        <th>Required</th>
                        <th>Value</th>
                    </tr>
                    <tbody>

                        <tr *ngFor="let field of projectRiskRatings; let i = index;">
                            <td>{{i + 1}}</td>
                            <td>{{field.categoryName}}</td>
                            <td>
                                <div class="form-group row" style="margin:0px">
                                    <div>
                                        <select class="form-control" id={{field.categoryId}} name={{field.categoryId}}
                                            formControlName={{field.categoryId}}
                                            [ngClass]="projectRiskRatingForm.controls[field.categoryId].valid ? 'valid-input' : 'required-input'">
                                            <option value="">-- Select --</option>
                                            <option *ngFor=" let x of field.criterias" [value]="x.criteriaValue">
                                                {{x.criteria}}</option>
                                        </select>
                                    </div>
                                </div>
                            </td>
                        </tr>

                    </tbody>
                </table>
                <div class="form-group">
                    <label for="projectLocation" class="col-md-2 control-label">Project Location
                    </label>
                    <div class="col-md-4">
                        <input type="text" name="projectLocation" formControlName="projectLocation" id="projectLocation"
                            class="form-control"
                            [ngClass]="projectRiskRatingForm.controls['projectLocation'].valid ? 'valid-input' : 'required-input'">
                    </div>
                </div>
                <div class="form-group">
                    <label for="projectDetails" class="col-md-2 control-label">Project Details
                    </label>
                    <div class="col-md-4">
                        <textarea type="text" name="projectDetails" formControlName="projectDetails" id="projectDetails"
                            class="form-control"
                            [ngClass]="projectRiskRatingForm.controls['projectDetails'].valid ? 'valid-input' : 'required-input'"></textarea>
                    </div>
                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-md-12">
                            <button type="button" (click)="submitProjectRiskRatingForm(projectRiskRatingForm)"
                                [disabled]="projectRiskRatingForm.invalid"
                                class="btn btn-success pull-right">Save</button>
                            <button type="button" (click)="displayProjectRiskRatingModal=false" style="margin-right:5px"
                                class="btn btn-danger pull-right">Cancel</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

</p-dialog>

<!-- <p-dialog [responsive]=true [(visible)]="displayReport" width="800" modal="modal" showEffect="fade">

        <div class="panel-footer">
            <div class="row">
                <div class="col-md-12">
                    <button type="button" (click)="displayReport=false" style="margin-right:5px" class="btn btn-danger pull-right">Cancel</button>
                </div>
            </div>
        </div>
    </p-dialog> -->