<div *ngIf="displaySearch" class="ui-g">
    <div class="ui-g-12 no-padding">
        <div class="card no-padding">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-md-12">
                            <h2 class="panel-title pull-left"> {{pageTitle}} </h2>
                        </div>
                    </div>
                </div>
                <div class="form-horizontal">
                        <p-tabView>
                          <p-tabPanel header="Operation" >
                        <div class="panel-body">
                           
                                <table *ngIf="loanViewSelection != null" class="table table-customer-information">
                                        <tbody>
                          
                                          <tr>
                                            <td>
                                              <strong>Reference Number:</strong>
                                            </td>
                                            <td>{{ loanViewSelection.loanReferenceNumber ? loanViewSelection.loanReferenceNumber : 'N/A'}}</td>
                                            <td>
                                              <strong>Application Reference No:</strong>
                                            </td>
                                            <td>{{ loanViewSelection.applicationReferenceNumber ? loanViewSelection.applicationReferenceNumber : 'N/A'}}</td>
                                            <td>
                                              <strong> CASA Account Number</strong>
                                            </td>
                                            <td>{{ loanViewSelection.casaAccountNumber }}</td>
                                  
                                          </tr>
                                          <tr>
                                            <td>
                                              <strong>Customer Code</strong>
                                            </td>
                                            <td>{{ loanViewSelection.customerCode }}</td>
                                            <td>
                                              <strong>Customer Name</strong>
                                            </td>
                                            <td>{{ loanViewSelection.customerName ? loanViewSelection.customerName : 'N/A'}}</td>
                                            <td>
                                              <strong> Product Account Name</strong>
                                            </td>
                                            <td>{{ loanViewSelection.productAccountName }}</td>
                          
                                          </tr>
                                          <tr>
                                            <td>
                                              <strong>Last Operation</strong>
                                            </td>
                                            <td>{{ loanViewSelection.operationName }}</td>
                                            <td>
                                              <strong>Product Type</strong>
                                            </td>
                                            <td>{{ loanViewSelection.productTypeName }}</td>
                                            <td>
                                              <strong> Effective Date</strong>
                                            </td>
                                            <td>{{ loanViewSelection.effectiveDate | date }}</td>
                                          </tr>
                                          <tr>
                                            <td>
                                              <strong>Branch Name</strong>
                                            </td>
                                            <td>{{ loanViewSelection.branchName }}</td>
                                            <td>
                                              <strong>Customer Type</strong>
                                            </td>
                                            <td>{{ loanViewSelection.loanTypeName }}</td>
                                            <td>
                                              <strong> Sector Name</strong>
                                            </td>
                                            <td>{{ loanViewSelection.sectorName }}</td>
                                          </tr>
                                          <tr>
                                            <td>
                                              <strong> Relationship Manager</strong>
                                            </td>
                                            <td>{{ loanViewSelection.relationshipOfficerName ? loanViewSelection.relationshipOfficerName : 'N/A' }}</td>
                                            <td>
                                              <strong>Business Manager</strong>
                                            </td>
                                            <td>{{ loanViewSelection.relationshipManagerName }}</td>
                                            <td>
                                              <strong> Maturity Date</strong>
                                            </td>
                                            <td>{{ loanViewSelection.maturityDate | date }}</td>
                                          </tr>
                                          <tr>
                                            <td>
                                              <strong> Amount</strong>
                                            </td>
                                            <td>{{ loanViewSelection.principalAmount }}</td>
                                            <td>
                                              <strong> Interest Rate</strong>
                                            </td>
                                            <td>{{ loanViewSelection.interestRate }}</td>
                                            <td>
                                              <strong> SubSector Name</strong>
                                            </td>
                                            <td>{{ loanViewSelection.subSectorName }}</td>
                                          </tr>
                                          <tr>
                                            <td>
                                              <strong> Outstanding Principal</strong>
                                            </td>
                                            <td>{{ loanViewSelection.outstandingPrincipal }}</td>
                                            <td>
                                              <strong> Outstanding Interest</strong>
                                            </td>
                                            <td>{{ loanViewSelection.outstandingInterest }}</td>
                                            <td>
                                              <strong> Currency</strong>
                                            </td>
                                            <td>{{ loanViewSelection.currency}}</td>
                                          </tr>
                                          <tr>
                                            <td>
                                                <strong> Tenor</strong>
                                              </td>
                                              <td>{{ loanViewSelection.tenor }}</td>
                                              <td>
                                                <strong> Booking Date</strong>
                                              </td>
                                              <td>{{ loanViewSelection.bookingDate | date }}</td>
                                            <td>
                                              <strong> Exchange Rate</strong>
                                            </td>
                                            <td>{{ loanViewSelection.exchangeRate }}</td>
                                          </tr>
                                          <tr>
                                              <td>
                                                  <strong> Accruled Amount</strong>
                                                </td>
                                                <td>{{ loanViewSelection.accrualedAmount }}</td>
                                               
                                            </tr>
                                        </tbody>
                                </table>
                            <fieldset style="padding-left:14px">
                                <form *ngIf="!displayPreviousInstructions" [formGroup]="autoRolloverForm" autocomplete="off">

                                    <legend>
                                      <strong>New Tenor</strong>
                                    </legend>
                                    <div class="form-group">
                        
                                        <label class="col-md-2">Take Fee?</label>
                    
                                        <div class="col-md-4">
                                                <select name="takeFeeStatus" formControlName="takeFeeStatus" [(ngModel)]="takeFeeStatus" class="form-control"
                                                [ngClass]="!autoRolloverForm.controls['takeFeeStatus'].valid ? 'required-input' : 'valid-input'">
                                                    <option value="">--- Select Status ---</option>
                                                    <option value="1"> Take Fee </option>
                                                    <option value="2"> Do Not Take Fee </option>
                    
                                                </select>
                                            </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="newTenor" class="control-label col-md-2">Add Tenor (days)</label>
                                        <div class="col-md-2 ">
                                          <input type="text" name="newTenor" formControlName="newTenor" id="tempTenor" class="form-control" [ngClass]="!autoRolloverForm.controls['newTenor'].valid ? 'required-input' : 'valid-input'">
                                          </div>
                                          <div class="col-md-2 ">
                                                  <button (click)="calculateNewTenor(autoRolloverForm)" class="btn btn-sm btn-primary" ><span class="glyphicon glyphicon-plus"></span> Add Tenor</button>
                                              <!-- <button (click)="calculateNewTenor(autoRolloverForm)" class="btn btn-sm btn-primary" [disabled]="!autoRolloverForm.valid"><span class="glyphicon glyphicon-plus"></span> Add Tenor</button> -->
                                          </div>
                                          
                                        
                                          <label for="newMaturity" class="control-label col-md-2">New Expiry Date</label>
                                        <div class="col-md-4 ">
                                          <input type="text" [attr.disabled]="true" name="newMaturity" formControlName="newMaturity" id="newMaturity" class="form-control" [ngClass]="!autoRolloverForm.controls['newMaturity'].valid ? 'required-input' : 'valid-input'">
                                          </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="newTenorLeft" class="control-label col-md-2">New Tenor Left (days)</label>
                                        <div class="col-md-4 ">
                                          <input type="text" [attr.disabled]="true" name="newTenorLeft" value="{{newTenorLeft}}" id="tempTenor" class="form-control" >
                                          </div>

                                          <label for="totalTenor" class="control-label col-md-2">Total Tenor (days)</label>
                                        <div class="col-md-4 ">
                                          <input type="text" [attr.disabled]="true" name="totalTenor" value="{{totalTenor}}" id="totalTenor" class="form-control" >
                                          </div>
                                    </div>
                                  </form>

                            </fieldset>                            
                        </div> 
                      </p-tabPanel>
                      <p-tabPanel header="Take Fee">
                        <take-fee-shared [loanSystemTypeId]="loanSystemTypeId" [amount]="loanViewSelection.outstandingPrincipal" [selectedLoanId]="termLoanId" [customerId]="customerId" [currencyId]="currencyId" (takeFees)="takeFees($event)"></take-fee-shared>
                    </p-tabPanel>
                      <p-tabPanel *ngIf="displayRefered"  header="Comments">
                          <div class="panel-body">
                              <p-dataTable [value]="approvalWorkflowData" [paginator]="true" [rows]="5" [responsive]="true">
                                  <p-column field="requestStaffName" header="Intiated By"></p-column>
                                  <p-column field="requestApprovalLevel" header="Initiator Approval Level"></p-column>
                                  <!-- <p-column field="responseStaffName" header="Directed To"></p-column> -->
                                  <p-column field="responseApprovalLevel" header="Response Approval Level"></p-column>
                                  <p-column field="approvalStatus" header="Approval Status"></p-column>
                                  <p-column field="comment" header="Comment"></p-column>
                                  <p-column field="systemArrivalDate" header="Date of Arrival">
                                      <ng-template let-col let-apr="rowData" pTemplate="body">
                                          {{apr[col.field] | date: 'medium'}}
                                      </ng-template>
                                  </p-column>
                                  <p-column field="systemResponseDate" header="Date of Response">
                                      <ng-template let-col let-apr="rowData" pTemplate="body">
                                          {{apr[col.field] | date: 'medium' }}
                                      </ng-template>
                                  </p-column>
                              </p-dataTable>
                          </div>
                      </p-tabPanel>
                        </p-tabView>
                        <div class="panel-footer">
                          <div class="row">
                              <div class="col-md-12">
                                <button type="button" (click)="addTenor(autoRolloverForm)" [disabled]="!autoRolloverForm.valid && !hasNewMaturityDate || !takeFeeStatus " class="btn btn-success ">Submit</button>
                              </div>
                          </div>
                      </div>
                </div>
            </div>
        </div>
    </div>
</div>
     
      
     <fintrakbanking-message [title]="title" [message]="message" [show]="show" [cssClass]="cssClass" (closeEvent)="hideMessage($event)"></fintrakbanking-message>