<div class="form-horizontal" *ngIf="displayDetails">
  <div class="form-group">
    <p-tabView>
      <p-tabPanel header="Facility Details" *ngIf="displayFacilityDetails">
        <div style="margin-bottom:0" class="panel panel-default">
          <div class="panel-heading">
            <h2 class="panel-title">
             Current Facility Details 
              <!-- {{ loanSelection }} -->
            </h2>
          </div>
          <div class="panel-body">
            <table *ngIf="loanSelection != null" class="table table-customer-information">
              <tbody>

                <tr>
                  <td>
                    <strong>Reference Number:</strong>
                  </td>
                  <td>{{ loanSelection.loanReferenceNumber ? loanSelection.loanReferenceNumber : 'N/A'}}</td>
                  <td>
                    <strong>Application Reference No:</strong>
                  </td>
                  <td>{{ loanSelection.applicationReferenceNumber ? loanSelection.applicationReferenceNumber : 'N/A'}}</td>
                  <td>
                    <strong> CASA Account Number</strong>
                  </td>
                  <td>{{ loanSelection.casaAccountNumber }}</td>
        
                </tr>
                <tr>
                  <td>
                    <strong>Customer Code</strong>
                  </td>
                  <td>{{ loanSelection.customerCode }}</td>
                  <td>
                    <strong>Customer Name</strong>
                  </td>
                  <td>{{ loanSelection.customerName ? loanSelection.customerName : 'N/A'}}</td>
                  <td>
                    <strong> Product Account Name</strong>
                  </td>
                  <td>{{ loanSelection.productAccountName }}</td>
                </tr>
                <tr>
                  <td>
                    <strong>Last Operation</strong>
                  </td>
                  <td>{{ loanSelection.operationName }}</td>
                  <td>
                    <strong>Product Type</strong>
                  </td>
                  <td>{{ loanSelection.productTypeName }}</td>
                  <td>
                    <strong> Effective Date</strong>
                  </td>
                  <td>{{ loanSelection.effectiveDate | date }}</td>
                </tr>
                <tr>
                  <td>
                    <strong>Branch Name</strong>
                  </td>
                  <td>{{ loanSelection.branchName }}</td>
                  <td>
                    <strong>Customer Type</strong>
                  </td>
                  <td>{{ loanSelection.customerType }}</td>
                  <td>
                    <strong> Sector Name</strong>
                  </td>
                  <td>{{ loanSelection.sectorName }}</td>
                </tr>
                <tr>
                  <td>
                    <strong> Relationship Manager</strong>
                  </td>
                  <td>{{ loanSelection.relationshipOfficerName ? loanSelection.relationshipOfficerName : 'N/A' }}</td>
                  <td>
                    <strong>Business Manager</strong>
                  </td>
                  <td>{{ loanSelection.relationshipManagerName }}</td>
                  <td>
                    <strong> Maturity Date</strong>
                  </td>
                  <td>{{ loanSelection.maturityDate | date }}</td>
                </tr>
                <tr>
                  <td>
                    <strong> Amount</strong>
                  </td>
                  <td>{{ loanSelection.principalAmount | currency:loanSelection.currencyCode:true:'1.2-2'}}</td>
                  <td>
                    <strong> Interest Rate</strong>
                  </td>
                  <td>{{ loanSelection.interestRate }}</td>
                  <td>
                    <strong> SubSector Name</strong>
                  </td>
                  <td>{{ loanSelection.subSectorName }}</td>
                </tr>
                <tr>
                  <td>
                    <strong> Outstanding Principal</strong>
                  </td>
                  <td>{{ loanSelection.outstandingPrincipal | currency:loanSelection.currencyCode:true:'1.2-2'}}</td>
                  <td>
                    <strong> Outstanding Interest</strong>
                  </td>
                  <td>{{ loanSelection.outstandingInterest | currency:loanSelection.currencyCode:true:'1.2-2' }}</td>
                  <td>
                    <strong> Currency</strong>
                  </td>
                  <td>{{ loanSelection.currency}}</td>
                </tr>
                <tr>
                  <td>
                    <strong> Principal Frequency</strong>
                  </td>
                  <td>{{ loanSelection.pricipalFrequencyTypeName }}</td>
                  <td>
                    <strong> Interest Frequency</strong>
                  </td>
                  <td>{{ loanSelection.interestFrequencyTypeName }}</td>
                  <td>
                    <strong> Exchange Rate</strong>
                  </td>
                  <td>{{ loanSelection.exchangeRate }}</td>
                </tr>
                <tr>
                  <td>
                    <strong> First Principal Payment Date</strong>
                  </td>
                  <td>{{ loanSelection.firstPrincipalPaymentDate | date }}</td>
                  <td>
                    <strong> First Interest Payment Date</strong>
                  </td>
                  <td>{{ loanSelection.firstInterestPaymentDate | date }}</td>
                </tr>

                <tr>
                  <td>
                    <strong> Tenor</strong>
                  </td>
                  <td>{{ loanSelection.tenor }}</td>
                  <td>
                    <strong> Booking Date</strong>
                  </td>
                  <td>{{ loanSelection.bookingDate | date }}</td>
                </tr>

              </tbody>
            </table>
          </div>

        </div>
      </p-tabPanel>

      <p-tabPanel header="Contingent Liability Details" *ngIf="!displayFacilityDetails">
        <div style="margin-bottom:0" class="panel panel-default">
          <div class="panel-heading">
            <h2 class="panel-title">
              Contingent Liability Details
              <!-- {{ loanSelection }} -->
            </h2>

          </div>
          <div class="panel-body">
            <table *ngIf="loanSelection != null" class="table table-customer-information">
              <tbody>

                <tr>
                  <td>
                    <strong>Facility Reference No:</strong>
                  </td>
                  <td>{{ loanSelection.loanReferenceNumber ? loanSelection.loanReferenceNumber : 'N/A'}}</td>
                  <td>
                    <strong>Application Reference No:</strong>
                  </td>
                  <td>{{ loanSelection.applicationReferenceNumber ? loanSelection.applicationReferenceNumber : 'N/A'}}</td>
                  <td>
                    <strong> CASA Account Number</strong>
                  </td>
                  <td>{{ loanSelection.casaAccountNumber  }}<div style="text-align:right">
                      <button (click)="showBalance()" pButton type="button" label="Get Balance"></button>
                  </div></td>
        
                </tr>
                <tr>
                  <td>
                    <strong>Customer Code</strong>
                  </td>
                  <td>{{ loanSelection.customerCode }}</td>
                  <td>
                    <strong>Customer Name</strong>
                  </td>
                  <td>{{ loanSelection.customerName ? loanSelection.customerName : 'N/A'}}</td>
                  <td>
                    <strong> Product Account Name</strong>
                  </td>
                  <td>{{ loanSelection.productAccountName }}</td>

                </tr>
                <tr>
                  <td>
                    <strong>Last Operation</strong>
                  </td>
                  <td>{{ loanSelection.operationName }}</td>
                  <td>
                    <strong>Product Type</strong>
                  </td>
                  <td>{{ loanSelection.productTypeName }}</td>
                  <td>
                    <strong> product Name</strong>
                  </td>
                  <td>{{ loanSelection.productName }}</td>
                </tr>
                <tr>
                  <td>
                    <strong>Branch Name</strong>
                  </td>
                  <td>{{ loanSelection.branchName }}</td>
                  <td>
                    <strong>Customer Type</strong>
                  </td>
                  <td>{{ loanSelection.customerType }}</td>
                  <td>
                    <strong> Sector Name</strong>
                  </td>
                  <td>{{ loanSelection.sectorName }}</td>
                </tr>
                <tr>
                  <td>
                    <strong> Relationship Manager</strong>
                  </td>
                  <td>{{ loanSelection.relationshipOfficerName ? loanSelection.relationshipOfficerName : 'N/A' }}</td>
                  <td>
                    <strong>Business Manager</strong>
                  </td>
                  <td>{{ loanSelection.relationshipManagerName }}</td>
                  <td>
                    <strong> SubSector Name</strong>
                  </td>
                  <td>{{ loanSelection.subSectorName }}</td>
                </tr>
                <tr>
                  <td>
                    <strong> Booking Date</strong>
                  </td>
                  <td>{{ loanSelection.bookingDate | date }}</td>
                  <td>
                    <strong>Effective Date</strong>
                  </td>
                  <td>{{ loanSelection.effectiveDate | date }}</td>
                  <td>
                    <strong> Maturity Date</strong>
                  </td>
                  <td>{{ loanSelection.maturityDate | date }}</td>
                </tr>

                <tr>
                  <td>
                    <strong> Contingent Amount</strong>
                  </td>
                  <td>{{ loanSelection.principalAmount | number:'1.2' }}</td>
                 
                  <td>
                    <strong>Is Tenored</strong>
                  </td>
                  <td>{{ loanSelection.istenored }}</td>
                  <td>
                      <strong> Currency</strong>
                    </td>
                    <td>{{ loanSelection.currency}}</td>
                </tr>
                
                <tr>
                    <td>
                        <strong> Is Bank Format</strong>
                      </td>
                      <td>{{ loanSelection.isbankFormat }}</td>
                  <td>
                    <strong> Exchange Rate</strong>
                  </td>
                  <td>{{ loanSelection.exchangeRate }}</td>
                  <td>
                      <strong> Loan Status</strong>
                    </td>
                    <td>{{ loanSelection.loanStatus   }}</td>
                </tr>
               
                <tr>
                    <td>
                        <strong> Is Disbursed</strong>
                      </td>
                      <td>{{ loanSelection.isDisbursedState   }}</td>
                      <td>
                        <strong> Approval Status</strong>
                      </td>
                      <td>{{ loanSelection.ApprovalStatus   }}</td>
                   <td>
                    <strong> Date Approved</strong>
                  </td>
                  <td>{{ loanSelection.dateApproved  | date  }}</td>

                </tr>
              </tbody>
            </table>
          </div>

        </div>
      </p-tabPanel>
      <p-tabPanel header="Covenant Details">
        <div style="margin-bottom:0" class="panel panel-default">
          <div class="panel-heading">
            <h2 class="panel-title">
              Covenant Details
            </h2>
          </div>
          <div class="panel-body">
            <p-dataTable [value]="convenatDetails" [responsive]="true">
              <p-header>Covenant Details</p-header>
              <p-column field="covenantDetail" header="Covenant"></p-column>
              <p-column field="covenantAmount" header="Amount"></p-column>
              <p-column field="covenantDate" header="Date"></p-column>
              <p-column field="frequencyTypeName" header="Frequency"></p-column>
            </p-dataTable>
          </div>
          <div class="panel-footer">
            <div class="row">
              <div class="col-md-12">
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
      <p-tabPanel header="Fees Details">
        <div style="margin-bottom:0" class="panel panel-default">
          <div class="panel-heading">
            <h2 class="panel-title">
              Fees Details
            </h2>
          </div>
          <div class="panel-body">
            <p-dataTable [value]="chargeFeeDetails" [responsive]="true">
              <p-header>Fees Details</p-header>
              <p-column field="chargeFeeName" header="Charge Fee Name"></p-column>
              <p-column field="feeAmount" header="Fee Amount"></p-column>
              <p-column field="feeIntervalName" header="Fee Interval"></p-column>
              <p-column field="rate" header="Rate"></p-column>
            </p-dataTable>
          </div>
          <div class="panel-footer">
            <div class="row">
              <div class="col-md-12">
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
      <p-tabPanel *ngIf="guarantor" header="Guarantors Details">
        <div style="margin-bottom:0" class="panel panel-default">
          <div class="panel-heading">
            <h2 class="panel-title">
              Guarantors Details
            </h2>
          </div>
          <div class="panel-body">
            <p-dataTable [value]="guarantorDetails" [responsive]="true">
              <p-header>Guarantors Details</p-header>
              <p-column field="fullName" header="Guarantor Name"></p-column>
              <p-column field="emailAddress" header="Email Address"></p-column>
              <p-column field="address" header="Contact Address"></p-column>
              <p-column field="phoneNumber1" header="Phone Number"></p-column>
              <p-column field="relationship" header="Relationship"></p-column>
            </p-dataTable>
          </div>
          <div class="panel-footer">
            <div class="row">
              <div class="col-md-12">
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
      <p-tabPanel header="Collateral Details">
        <div style="margin-bottom:0" class="panel panel-default">
          <div class="panel-heading">
            <h2 class="panel-title">
              Collateral Details
            </h2>
          </div>
          <div class="panel-body">
            <p-dataTable [value]="collateralDetails" [responsive]="true">
              <p-header>Collateral Details</p-header>
              <p-column field="collateralCode" header="Code"></p-column>
              <p-column field="collateralType" header="Collateral Type"></p-column>
              <p-column field="collateralValue" header="Value"></p-column>
              <p-column field="haircut" header="Haircut"></p-column>
              <p-column field="securityValue" header="Security Value"></p-column>
            </p-dataTable>
          </div>
          <div class="panel-footer">
            <div class="row">
              <div class="col-md-12">
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
      <p-tabPanel header="Schedule Details" *ngIf="!displayCustomerODDetails">
        <div style="margin-bottom:0" class="panel panel-default">
          <div class="panel-heading">
            <h2 class="panel-title">
              Schedule Details
            </h2>
          </div>
          <div class="panel-body">
            <fieldset>
              <table style="margin-bottom: 20px">
                <tr>
                  <td style="font-size: 12px;font-weight: bold;padding: 4px">Granted Amount</td>
                  <td style="text-align: right;padding-left: 10px;padding: 4px">{{loanSelection?.principalAmount}}</td>
                  <td style="font-size: 12px;font-weight: bold;padding-left: 20px;padding: 4px">Interest Rate</td>
                  <td style="text-align: right;padding: 4px">{{loanSelection?.interestRate}} %</td>
                  <td style="font-size: 12px;font-weight: bold;padding-left: 20px;padding: 4px">Effective Interest Rate</td>
                  <td style="text-align: right;padding: 4px">{{loanSelection?.effectiveInterestRate | number: '1.2-2'}} %</td>
                </tr>
                <tr>
                  <td style="font-size: 12px;font-weight: bold;padding: 4px">Effective Date</td>
                  <td style="text-align: right;padding-left: 10px;padding: 4px">{{loanSelection?.effectiveDate | date}}</td>
                  <td style="font-size: 12px;font-weight: bold;padding-left: 20px;padding: 4px">Maturity Date</td>
                  <td style="text-align: right;padding: 4px">{{loanSelection?.maturityDate | date}}</td>
                  <td style="font-size: 12px;font-weight: bold;padding-left: 20px;padding: 4px">Schedule Type</td>
                  <td style="text-align: right;padding: 4px">{{loanSelection?.scheduleTypeName}}</td>
                </tr>
              </table>

            </fieldset>


            <p-dataTable scrollable="true" scrollHeight="200px" [value]="loanScheduleDetails" [responsive]=true selectionMode="single">
              <p-column [style]="{'width':'80px'}" field="paymentNumber" header="No"></p-column>
              <p-column field="paymentDate" header="Payment Date">
                <ng-template let-col let-schedule="rowData" pTemplate="body">
                  <span>{{schedule[col.field] | date}}</span>
                </ng-template>
              </p-column>
              <p-column field="startPrincipalAmount" header="Start Principal">
                <ng-template let-col let-schedule="rowData" pTemplate="body">
                  <span style="text-align: right">{{schedule[col.field] | number: '1.2-2'}}</span>
                </ng-template>
              </p-column>
              <p-column field="periodPaymentAmount" header="Periodic Amount">
                <ng-template let-col let-schedule="rowData" pTemplate="body">
                  <span style="text-align: right">{{schedule[col.field] | number: '1.2-2'}}</span>
                </ng-template>
              </p-column>
              <p-column field="periodPrincipalAmount" header="Principal Amount">
                <ng-template let-col let-schedule="rowData" pTemplate="body">
                  <span style="text-align: right">{{schedule[col.field] | number: '1.2-2'}}</span>
                </ng-template>
              </p-column>
              <p-column field="periodInterestAmount" header="Interest Amount">
                <ng-template let-col let-schedule="rowData" pTemplate="body">
                  <span style="text-align: right">{{schedule[col.field] | number: '1.2-2'}}</span>
                </ng-template>
              </p-column>
              <p-column field="endPrincipalAmount" header="Balance">
                <ng-template let-col let-schedule="rowData" pTemplate="body">
                  <span style="text-align: right">{{schedule[col.field] | number: '1.2-2'}}</span>
                </ng-template>
              </p-column>

              <p-column field="amortisedStartPrincipalAmount" header="AM Start Principal">
                <ng-template let-col let-schedule="rowData" pTemplate="body">
                  <span style="text-align: right">{{schedule[col.field] | number: '1.2-2'}}</span>
                </ng-template>
              </p-column>
              <p-column field="amortisedPeriodPaymentAmount" header="AM Periodic Amount">
                <ng-template let-col let-schedule="rowData" pTemplate="body">
                  <span style="text-align: right">{{schedule[col.field] | number: '1.2-2'}}</span>
                </ng-template>
              </p-column>
              <p-column field="amortisedPeriodPrincipalAmount" header="AM Principal Amount">
                <ng-template let-col let-schedule="rowData" pTemplate="body">
                  <span style="text-align: right">{{schedule[col.field] | number: '1.2-2'}}</span>
                </ng-template>
              </p-column>
              <p-column field="amortisedPeriodInterestAmount" header="AM Interest Amount">
                <ng-template let-col let-schedule="rowData" pTemplate="body">
                  <span style="text-align: right">{{schedule[col.field] | number: '1.2-2'}}</span>
                </ng-template>
              </p-column>
              <p-column field="amortisedEndPrincipalAmount" header="AM Balance">
                <ng-template let-col let-schedule="rowData" pTemplate="body">
                  <span style="text-align: right">{{schedule[col.field] | number: '1.2-2'}}</span>
                </ng-template>
              </p-column>
            </p-dataTable>
          </div>

        </div>
      </p-tabPanel>   
      <p-tabPanel header="Supporting Documents">
        {{loanSelection?.customerName}} | {{loanSelection?.applicationReferenceNumber}}
        <div class="panel panel-default">
          <div class="panel-heading">
              <h2 class="panel-title">
               Supporting Documents
                  <!-- {{ supportingDocuments.length }} -->
              </h2>
          </div>
          <div class="panel-body">
  
              <p-dataTable [value]="supportingDocuments" [paginator]="true" [rows]="5">
                  <p-column field="documentTitle" header="Document Title" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                  <p-column field="fileExtension" header="Type" [filter]="true" filterMatchMode="contains" [style]="{'width':'60px'}"></p-column>
      
                  <p-column [style]="{'width':'150px'}">
                      <ng-template pTemplate="header"> </ng-template>
                      <ng-template pTemplate="body" let-d="rowData" let-i="rowIndex">
                          <a *ngIf="['jpg','jpeg', 'png'].indexOf(d.fileExtension.toLowerCase()) > -1" (click)="viewDocument(d)" href="javascript:void(0)">View</a>
                          <a *ngIf="['doc','docx', 'pdf','xls', 'xlsx'].indexOf(d.fileExtension.toLowerCase()) > -1" (click)="DownloadDocument(d.documentId)" href="javascript:void(0)">Download</a>
                      </ng-template>
                  </p-column>
      
              </p-dataTable>
      
      

      
      
          </div>
      </div>
        </p-tabPanel>     
    </p-tabView>
  </div>
</div>

<p-dialog [responsive]=true [(visible)]="displayDocument" modal="modal" showEffect="fade" width="1200">
  <div style="margin-bottom:0" class="panel panel-default">

      <div class="panel-heading">
          <h2 class="panel-title">
              Document Title:
              <strong>{{ selectedDocument }}</strong>
          </h2>
          <div class="pull-right">
              <a class="close" (click)="displayDocument=false">&times;</a>
          </div>
      </div>

      <div class="panel-body" style="overflow:auto;height:450px">

          <img *ngIf="binaryFile" style="max-width: 100%; display: block 2px black;" [src]="'data:image/jpg;base64,'+binaryFile" alt="" class="img-thumbnail">

      </div>

  </div>
</p-dialog>

<!--modal for all documentation -->

<p-dialog [responsive]=true [(visible)]="displayDocumentation" modal="modal" showEffect="fade" width="1200">
    <div *ngIf="displayDocumentation" style="margin-bottom:0" class="panel panel-default">

        <div class="panel-heading">
            <h2 class="panel-title">
                Appraisal Documentation for REFERENCE:
                <strong>{{ loanSelection?.applicationReferenceNumber }}</strong> of OBLIGOR:
                <strong>{{ loanSelection?.customerName }}</strong>
            </h2>
            <div class="pull-right">
                <a class="close" (click)="closeDocumentation()">&times;</a>
            </div>
        </div>

        <div class="panel-body" style="overflow:auto;height:450px">
            <div *ngFor="let x of documentations">
                <p><strong>{{x.title}}</strong></p>
                <span [innerHtml]="x.templateDocument"></span>
            </div>
        </div>

    </div>
</p-dialog>

<!--modal ends-->